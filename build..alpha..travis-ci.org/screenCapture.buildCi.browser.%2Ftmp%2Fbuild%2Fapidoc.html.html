<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="http://apnagent.qualiancy.com">apnagent (v1.1.3)</a>
</h1>
<h4>Node adapter for Apple Push Notification (APN) service.</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent">module apnagent</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent">
            function <span class="apidocSignatureSpan">apnagent.</span>Agent
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super">
            function <span class="apidocSignatureSpan">apnagent.</span>Agent._super
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype._queueIterator">
            function <span class="apidocSignatureSpan">apnagent.</span>Agent._super.prototype._queueIterator
            <span class="apidocSignatureSpan">(buf, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.close">
            function <span class="apidocSignatureSpan">apnagent.</span>Agent._super.prototype.close
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.connect">
            function <span class="apidocSignatureSpan">apnagent.</span>Agent._super.prototype.connect
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.createMessage">
            function <span class="apidocSignatureSpan">apnagent.</span>Agent._super.prototype.createMessage
            <span class="apidocSignatureSpan">(enc)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.disable">
            function <span class="apidocSignatureSpan">apnagent.</span>Agent._super.prototype.disable
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.disabled">
            function <span class="apidocSignatureSpan">apnagent.</span>Agent._super.prototype.disabled
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.enable">
            function <span class="apidocSignatureSpan">apnagent.</span>Agent._super.prototype.enable
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.enabled">
            function <span class="apidocSignatureSpan">apnagent.</span>Agent._super.prototype.enabled
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.get">
            function <span class="apidocSignatureSpan">apnagent.</span>Agent._super.prototype.get
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.nextId">
            function <span class="apidocSignatureSpan">apnagent.</span>Agent._super.prototype.nextId
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.send">
            function <span class="apidocSignatureSpan">apnagent.</span>Agent._super.prototype.send
            <span class="apidocSignatureSpan">(msg, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.set">
            function <span class="apidocSignatureSpan">apnagent.</span>Agent._super.prototype.set
            <span class="apidocSignatureSpan">(key, value)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent.prototype._queueIterator">
            function <span class="apidocSignatureSpan">apnagent.</span>Agent.prototype._queueIterator
            <span class="apidocSignatureSpan">(obj, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent.prototype._reconnect">
            function <span class="apidocSignatureSpan">apnagent.</span>Agent.prototype._reconnect
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent.prototype.close">
            function <span class="apidocSignatureSpan">apnagent.</span>Agent.prototype.close
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent.prototype.connect">
            function <span class="apidocSignatureSpan">apnagent.</span>Agent.prototype.connect
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Device">
            function <span class="apidocSignatureSpan">apnagent.</span>Device
            <span class="apidocSignatureSpan">(token)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Device.prototype.equal">
            function <span class="apidocSignatureSpan">apnagent.</span>Device.prototype.equal
            <span class="apidocSignatureSpan">(dev)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Device.prototype.toBuffer">
            function <span class="apidocSignatureSpan">apnagent.</span>Device.prototype.toBuffer
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Device.prototype.toString">
            function <span class="apidocSignatureSpan">apnagent.</span>Device.prototype.toString
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback">
            function <span class="apidocSignatureSpan">apnagent.</span>Feedback
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super">
            function <span class="apidocSignatureSpan">apnagent.</span>Feedback._super
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.close">
            function <span class="apidocSignatureSpan">apnagent.</span>Feedback._super.prototype.close
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.connect">
            function <span class="apidocSignatureSpan">apnagent.</span>Feedback._super.prototype.connect
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.disable">
            function <span class="apidocSignatureSpan">apnagent.</span>Feedback._super.prototype.disable
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.disabled">
            function <span class="apidocSignatureSpan">apnagent.</span>Feedback._super.prototype.disabled
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.enable">
            function <span class="apidocSignatureSpan">apnagent.</span>Feedback._super.prototype.enable
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.enabled">
            function <span class="apidocSignatureSpan">apnagent.</span>Feedback._super.prototype.enabled
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.get">
            function <span class="apidocSignatureSpan">apnagent.</span>Feedback._super.prototype.get
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.set">
            function <span class="apidocSignatureSpan">apnagent.</span>Feedback._super.prototype.set
            <span class="apidocSignatureSpan">(key, value)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.unsub">
            function <span class="apidocSignatureSpan">apnagent.</span>Feedback._super.prototype.unsub
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.use">
            function <span class="apidocSignatureSpan">apnagent.</span>Feedback._super.prototype.use
            <span class="apidocSignatureSpan">(fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback.prototype.close">
            function <span class="apidocSignatureSpan">apnagent.</span>Feedback.prototype.close
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback.prototype.connect">
            function <span class="apidocSignatureSpan">apnagent.</span>Feedback.prototype.connect
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockAgent">
            function <span class="apidocSignatureSpan">apnagent.</span>MockAgent
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockAgent.prototype._queueIterator">
            function <span class="apidocSignatureSpan">apnagent.</span>MockAgent.prototype._queueIterator
            <span class="apidocSignatureSpan">(obj, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockAgent.prototype.close">
            function <span class="apidocSignatureSpan">apnagent.</span>MockAgent.prototype.close
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockAgent.prototype.connect">
            function <span class="apidocSignatureSpan">apnagent.</span>MockAgent.prototype.connect
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockAgent.prototype.setBadDevices">
            function <span class="apidocSignatureSpan">apnagent.</span>MockAgent.prototype.setBadDevices
            <span class="apidocSignatureSpan">(devices)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockFeedback">
            function <span class="apidocSignatureSpan">apnagent.</span>MockFeedback
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockFeedback.prototype.close">
            function <span class="apidocSignatureSpan">apnagent.</span>MockFeedback.prototype.close
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockFeedback.prototype.connect">
            function <span class="apidocSignatureSpan">apnagent.</span>MockFeedback.prototype.connect
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockFeedback.prototype.unsub">
            function <span class="apidocSignatureSpan">apnagent.</span>MockFeedback.prototype.unsub
            <span class="apidocSignatureSpan">(token, ts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.FeedbackAuthorizationError">
            function <span class="apidocSignatureSpan">apnagent.</span>errors.FeedbackAuthorizationError
            <span class="apidocSignatureSpan">(message, props, ssf)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.FeedbackAuthorizationError.prototype.serialize">
            function <span class="apidocSignatureSpan">apnagent.</span>errors.FeedbackAuthorizationError.prototype.serialize
            <span class="apidocSignatureSpan">(stack)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.GatewayAuthorizationError">
            function <span class="apidocSignatureSpan">apnagent.</span>errors.GatewayAuthorizationError
            <span class="apidocSignatureSpan">(message, props, ssf)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.GatewayAuthorizationError.prototype.serialize">
            function <span class="apidocSignatureSpan">apnagent.</span>errors.GatewayAuthorizationError.prototype.serialize
            <span class="apidocSignatureSpan">(stack)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.GatewayMessageError">
            function <span class="apidocSignatureSpan">apnagent.</span>errors.GatewayMessageError
            <span class="apidocSignatureSpan">(message, props, ssf)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.GatewayMessageError.prototype.serialize">
            function <span class="apidocSignatureSpan">apnagent.</span>errors.GatewayMessageError.prototype.serialize
            <span class="apidocSignatureSpan">(stack)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.MessageSerializationError">
            function <span class="apidocSignatureSpan">apnagent.</span>errors.MessageSerializationError
            <span class="apidocSignatureSpan">(message, props, ssf)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.MessageSerializationError.prototype.serialize">
            function <span class="apidocSignatureSpan">apnagent.</span>errors.MessageSerializationError.prototype.serialize
            <span class="apidocSignatureSpan">(stack)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">apnagent.</span>Agent._super._super.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">apnagent.</span>Agent._super.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">apnagent.</span>Agent.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">apnagent.</span>Device.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">apnagent.</span>Feedback._super.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">apnagent.</span>Feedback.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">apnagent.</span>MockAgent.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">apnagent.</span>MockFeedback.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">apnagent.</span>errors</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">apnagent.</span>errors.FeedbackAuthorizationError.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">apnagent.</span>errors.GatewayAuthorizationError.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">apnagent.</span>errors.GatewayMessageError.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">apnagent.</span>errors.MessageSerializationError.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">apnagent.</span>version</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Agent">module apnagent.Agent</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent.Agent">
            function <span class="apidocSignatureSpan">apnagent.</span>Agent
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super">
            function <span class="apidocSignatureSpan">apnagent.Agent.</span>_super
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Agent._super">module apnagent.Agent._super</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super._super">
            function <span class="apidocSignatureSpan">apnagent.Agent.</span>_super
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Agent._super._super.prototype">module apnagent.Agent._super._super.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super._super.prototype.addListener">
            function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>addListener
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super._super.prototype.bindEvent">
            function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>bindEvent
            <span class="apidocSignatureSpan">(ev, target)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super._super.prototype.emit">
            function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>emit
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super._super.prototype.hasListener">
            function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>hasListener
            <span class="apidocSignatureSpan">(ev, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super._super.prototype.listeners">
            function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>listeners
            <span class="apidocSignatureSpan">(ev)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super._super.prototype.many">
            function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>many
            <span class="apidocSignatureSpan">(ev, times, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super._super.prototype.off">
            function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>off
            <span class="apidocSignatureSpan">(ev, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super._super.prototype.on">
            function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>on
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super._super.prototype.once">
            function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>once
            <span class="apidocSignatureSpan">(ev, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super._super.prototype.proxyEvent">
            function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>proxyEvent
            <span class="apidocSignatureSpan">(ev, ns, target)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super._super.prototype.removeAllListeners">
            function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>removeAllListeners
            <span class="apidocSignatureSpan">(ev, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super._super.prototype.removeListener">
            function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>removeListener
            <span class="apidocSignatureSpan">(ev, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super._super.prototype.unbindEvent">
            function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>unbindEvent
            <span class="apidocSignatureSpan">(ev, target)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super._super.prototype.unproxyEvent">
            function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>unproxyEvent
            <span class="apidocSignatureSpan">(ev, ns, target)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Agent._super.prototype">module apnagent.Agent._super.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype._queueIterator">
            function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>_queueIterator
            <span class="apidocSignatureSpan">(buf, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.close">
            function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>close
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.connect">
            function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>connect
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.createMessage">
            function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>createMessage
            <span class="apidocSignatureSpan">(enc)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.disable">
            function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>disable
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.disabled">
            function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>disabled
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.enable">
            function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>enable
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.enabled">
            function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>enabled
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.get">
            function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>get
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.nextId">
            function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>nextId
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.send">
            function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>send
            <span class="apidocSignatureSpan">(msg, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.set">
            function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>set
            <span class="apidocSignatureSpan">(key, value)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Agent._super.prototype._queueIterator">module apnagent.Agent._super.prototype._queueIterator</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype._queueIterator._queueIterator">
            function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>_queueIterator
            <span class="apidocSignatureSpan">(buf, next)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Agent._super.prototype.close">module apnagent.Agent._super.prototype.close</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.close.close">
            function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>close
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Agent._super.prototype.connect">module apnagent.Agent._super.prototype.connect</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.connect.connect">
            function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>connect
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Agent._super.prototype.createMessage">module apnagent.Agent._super.prototype.createMessage</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.createMessage.createMessage">
            function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>createMessage
            <span class="apidocSignatureSpan">(enc)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Agent._super.prototype.disable">module apnagent.Agent._super.prototype.disable</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.disable.disable">
            function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>disable
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Agent._super.prototype.disabled">module apnagent.Agent._super.prototype.disabled</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.disabled.disabled">
            function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>disabled
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Agent._super.prototype.enable">module apnagent.Agent._super.prototype.enable</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.enable.enable">
            function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>enable
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Agent._super.prototype.enabled">module apnagent.Agent._super.prototype.enabled</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.enabled.enabled">
            function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>enabled
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Agent._super.prototype.get">module apnagent.Agent._super.prototype.get</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.get.get">
            function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>get
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Agent._super.prototype.nextId">module apnagent.Agent._super.prototype.nextId</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.nextId.nextId">
            function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>nextId
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Agent._super.prototype.send">module apnagent.Agent._super.prototype.send</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.send.send">
            function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>send
            <span class="apidocSignatureSpan">(msg, cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Agent._super.prototype.set">module apnagent.Agent._super.prototype.set</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent._super.prototype.set.set">
            function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>set
            <span class="apidocSignatureSpan">(key, value)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Agent.prototype">module apnagent.Agent.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent.prototype._queueIterator">
            function <span class="apidocSignatureSpan">apnagent.Agent.prototype.</span>_queueIterator
            <span class="apidocSignatureSpan">(obj, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent.prototype._reconnect">
            function <span class="apidocSignatureSpan">apnagent.Agent.prototype.</span>_reconnect
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent.prototype.close">
            function <span class="apidocSignatureSpan">apnagent.Agent.prototype.</span>close
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent.prototype.connect">
            function <span class="apidocSignatureSpan">apnagent.Agent.prototype.</span>connect
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Agent.prototype._queueIterator">module apnagent.Agent.prototype._queueIterator</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent.prototype._queueIterator._queueIterator">
            function <span class="apidocSignatureSpan">apnagent.Agent.prototype.</span>_queueIterator
            <span class="apidocSignatureSpan">(obj, next)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Agent.prototype._reconnect">module apnagent.Agent.prototype._reconnect</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent.prototype._reconnect._reconnect">
            function <span class="apidocSignatureSpan">apnagent.Agent.prototype.</span>_reconnect
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Agent.prototype.close">module apnagent.Agent.prototype.close</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent.prototype.close.close">
            function <span class="apidocSignatureSpan">apnagent.Agent.prototype.</span>close
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Agent.prototype.connect">module apnagent.Agent.prototype.connect</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Agent.prototype.connect.connect">
            function <span class="apidocSignatureSpan">apnagent.Agent.prototype.</span>connect
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Device">module apnagent.Device</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Device.Device">
            function <span class="apidocSignatureSpan">apnagent.</span>Device
            <span class="apidocSignatureSpan">(token)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Device.prototype">module apnagent.Device.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Device.prototype.equal">
            function <span class="apidocSignatureSpan">apnagent.Device.prototype.</span>equal
            <span class="apidocSignatureSpan">(dev)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Device.prototype.toBuffer">
            function <span class="apidocSignatureSpan">apnagent.Device.prototype.</span>toBuffer
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Device.prototype.toString">
            function <span class="apidocSignatureSpan">apnagent.Device.prototype.</span>toString
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Device.prototype.equal">module apnagent.Device.prototype.equal</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Device.prototype.equal.equal">
            function <span class="apidocSignatureSpan">apnagent.Device.prototype.</span>equal
            <span class="apidocSignatureSpan">(dev)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Device.prototype.toBuffer">module apnagent.Device.prototype.toBuffer</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Device.prototype.toBuffer.toBuffer">
            function <span class="apidocSignatureSpan">apnagent.Device.prototype.</span>toBuffer
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Device.prototype.toString">module apnagent.Device.prototype.toString</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Device.prototype.toString.toString">
            function <span class="apidocSignatureSpan">apnagent.Device.prototype.</span>toString
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Feedback">module apnagent.Feedback</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback.Feedback">
            function <span class="apidocSignatureSpan">apnagent.</span>Feedback
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super">
            function <span class="apidocSignatureSpan">apnagent.Feedback.</span>_super
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Feedback._super">module apnagent.Feedback._super</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super._super">
            function <span class="apidocSignatureSpan">apnagent.Feedback.</span>_super
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Feedback._super.prototype">module apnagent.Feedback._super.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.close">
            function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>close
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.connect">
            function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>connect
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.disable">
            function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>disable
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.disabled">
            function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>disabled
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.enable">
            function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>enable
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.enabled">
            function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>enabled
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.get">
            function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>get
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.set">
            function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>set
            <span class="apidocSignatureSpan">(key, value)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.unsub">
            function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>unsub
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.use">
            function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>use
            <span class="apidocSignatureSpan">(fn)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Feedback._super.prototype.close">module apnagent.Feedback._super.prototype.close</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.close.close">
            function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>close
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Feedback._super.prototype.connect">module apnagent.Feedback._super.prototype.connect</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.connect.connect">
            function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>connect
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Feedback._super.prototype.disable">module apnagent.Feedback._super.prototype.disable</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.disable.disable">
            function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>disable
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Feedback._super.prototype.disabled">module apnagent.Feedback._super.prototype.disabled</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.disabled.disabled">
            function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>disabled
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Feedback._super.prototype.enable">module apnagent.Feedback._super.prototype.enable</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.enable.enable">
            function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>enable
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Feedback._super.prototype.enabled">module apnagent.Feedback._super.prototype.enabled</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.enabled.enabled">
            function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>enabled
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Feedback._super.prototype.get">module apnagent.Feedback._super.prototype.get</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.get.get">
            function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>get
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Feedback._super.prototype.set">module apnagent.Feedback._super.prototype.set</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.set.set">
            function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>set
            <span class="apidocSignatureSpan">(key, value)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Feedback._super.prototype.unsub">module apnagent.Feedback._super.prototype.unsub</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.unsub.unsub">
            function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>unsub
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Feedback._super.prototype.use">module apnagent.Feedback._super.prototype.use</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback._super.prototype.use.use">
            function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>use
            <span class="apidocSignatureSpan">(fn)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Feedback.prototype">module apnagent.Feedback.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback.prototype.close">
            function <span class="apidocSignatureSpan">apnagent.Feedback.prototype.</span>close
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback.prototype.connect">
            function <span class="apidocSignatureSpan">apnagent.Feedback.prototype.</span>connect
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Feedback.prototype.close">module apnagent.Feedback.prototype.close</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback.prototype.close.close">
            function <span class="apidocSignatureSpan">apnagent.Feedback.prototype.</span>close
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.Feedback.prototype.connect">module apnagent.Feedback.prototype.connect</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.Feedback.prototype.connect.connect">
            function <span class="apidocSignatureSpan">apnagent.Feedback.prototype.</span>connect
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.MockAgent">module apnagent.MockAgent</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockAgent.MockAgent">
            function <span class="apidocSignatureSpan">apnagent.</span>MockAgent
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockAgent._super">
            function <span class="apidocSignatureSpan">apnagent.MockAgent.</span>_super
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.MockAgent.prototype">module apnagent.MockAgent.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockAgent.prototype._queueIterator">
            function <span class="apidocSignatureSpan">apnagent.MockAgent.prototype.</span>_queueIterator
            <span class="apidocSignatureSpan">(obj, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockAgent.prototype.close">
            function <span class="apidocSignatureSpan">apnagent.MockAgent.prototype.</span>close
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockAgent.prototype.connect">
            function <span class="apidocSignatureSpan">apnagent.MockAgent.prototype.</span>connect
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockAgent.prototype.setBadDevices">
            function <span class="apidocSignatureSpan">apnagent.MockAgent.prototype.</span>setBadDevices
            <span class="apidocSignatureSpan">(devices)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.MockAgent.prototype._queueIterator">module apnagent.MockAgent.prototype._queueIterator</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockAgent.prototype._queueIterator._queueIterator">
            function <span class="apidocSignatureSpan">apnagent.MockAgent.prototype.</span>_queueIterator
            <span class="apidocSignatureSpan">(obj, next)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.MockAgent.prototype.close">module apnagent.MockAgent.prototype.close</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockAgent.prototype.close.close">
            function <span class="apidocSignatureSpan">apnagent.MockAgent.prototype.</span>close
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.MockAgent.prototype.connect">module apnagent.MockAgent.prototype.connect</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockAgent.prototype.connect.connect">
            function <span class="apidocSignatureSpan">apnagent.MockAgent.prototype.</span>connect
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.MockAgent.prototype.setBadDevices">module apnagent.MockAgent.prototype.setBadDevices</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockAgent.prototype.setBadDevices.setBadDevices">
            function <span class="apidocSignatureSpan">apnagent.MockAgent.prototype.</span>setBadDevices
            <span class="apidocSignatureSpan">(devices)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.MockFeedback">module apnagent.MockFeedback</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockFeedback.MockFeedback">
            function <span class="apidocSignatureSpan">apnagent.</span>MockFeedback
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockFeedback._super">
            function <span class="apidocSignatureSpan">apnagent.MockFeedback.</span>_super
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.MockFeedback.prototype">module apnagent.MockFeedback.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockFeedback.prototype.close">
            function <span class="apidocSignatureSpan">apnagent.MockFeedback.prototype.</span>close
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockFeedback.prototype.connect">
            function <span class="apidocSignatureSpan">apnagent.MockFeedback.prototype.</span>connect
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockFeedback.prototype.unsub">
            function <span class="apidocSignatureSpan">apnagent.MockFeedback.prototype.</span>unsub
            <span class="apidocSignatureSpan">(token, ts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.MockFeedback.prototype.close">module apnagent.MockFeedback.prototype.close</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockFeedback.prototype.close.close">
            function <span class="apidocSignatureSpan">apnagent.MockFeedback.prototype.</span>close
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.MockFeedback.prototype.connect">module apnagent.MockFeedback.prototype.connect</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockFeedback.prototype.connect.connect">
            function <span class="apidocSignatureSpan">apnagent.MockFeedback.prototype.</span>connect
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.MockFeedback.prototype.unsub">module apnagent.MockFeedback.prototype.unsub</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.MockFeedback.prototype.unsub.unsub">
            function <span class="apidocSignatureSpan">apnagent.MockFeedback.prototype.</span>unsub
            <span class="apidocSignatureSpan">(token, ts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.errors">module apnagent.errors</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.FeedbackAuthorizationError">
            function <span class="apidocSignatureSpan">apnagent.errors.</span>FeedbackAuthorizationError
            <span class="apidocSignatureSpan">(message, props, ssf)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.GatewayAuthorizationError">
            function <span class="apidocSignatureSpan">apnagent.errors.</span>GatewayAuthorizationError
            <span class="apidocSignatureSpan">(message, props, ssf)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.GatewayMessageError">
            function <span class="apidocSignatureSpan">apnagent.errors.</span>GatewayMessageError
            <span class="apidocSignatureSpan">(message, props, ssf)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.MessageSerializationError">
            function <span class="apidocSignatureSpan">apnagent.errors.</span>MessageSerializationError
            <span class="apidocSignatureSpan">(message, props, ssf)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.errors.FeedbackAuthorizationError">module apnagent.errors.FeedbackAuthorizationError</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.FeedbackAuthorizationError.FeedbackAuthorizationError">
            function <span class="apidocSignatureSpan">apnagent.errors.</span>FeedbackAuthorizationError
            <span class="apidocSignatureSpan">(message, props, ssf)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.errors.FeedbackAuthorizationError.prototype">module apnagent.errors.FeedbackAuthorizationError.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.FeedbackAuthorizationError.prototype.constructor">
            function <span class="apidocSignatureSpan">apnagent.errors.FeedbackAuthorizationError.prototype.</span>constructor
            <span class="apidocSignatureSpan">(message, props, ssf)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.FeedbackAuthorizationError.prototype.serialize">
            function <span class="apidocSignatureSpan">apnagent.errors.FeedbackAuthorizationError.prototype.</span>serialize
            <span class="apidocSignatureSpan">(stack)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.FeedbackAuthorizationError.prototype.toJSON">
            function <span class="apidocSignatureSpan">apnagent.errors.FeedbackAuthorizationError.prototype.</span>toJSON
            <span class="apidocSignatureSpan">(stack)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">apnagent.errors.FeedbackAuthorizationError.prototype.</span>name</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.errors.FeedbackAuthorizationError.prototype.serialize">module apnagent.errors.FeedbackAuthorizationError.prototype.serialize</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.FeedbackAuthorizationError.prototype.serialize.serialize">
            function <span class="apidocSignatureSpan">apnagent.errors.FeedbackAuthorizationError.prototype.</span>serialize
            <span class="apidocSignatureSpan">(stack)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.errors.GatewayAuthorizationError">module apnagent.errors.GatewayAuthorizationError</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.GatewayAuthorizationError.GatewayAuthorizationError">
            function <span class="apidocSignatureSpan">apnagent.errors.</span>GatewayAuthorizationError
            <span class="apidocSignatureSpan">(message, props, ssf)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.errors.GatewayAuthorizationError.prototype">module apnagent.errors.GatewayAuthorizationError.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.GatewayAuthorizationError.prototype.constructor">
            function <span class="apidocSignatureSpan">apnagent.errors.GatewayAuthorizationError.prototype.</span>constructor
            <span class="apidocSignatureSpan">(message, props, ssf)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.GatewayAuthorizationError.prototype.serialize">
            function <span class="apidocSignatureSpan">apnagent.errors.GatewayAuthorizationError.prototype.</span>serialize
            <span class="apidocSignatureSpan">(stack)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.GatewayAuthorizationError.prototype.toJSON">
            function <span class="apidocSignatureSpan">apnagent.errors.GatewayAuthorizationError.prototype.</span>toJSON
            <span class="apidocSignatureSpan">(stack)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">apnagent.errors.GatewayAuthorizationError.prototype.</span>name</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.errors.GatewayAuthorizationError.prototype.serialize">module apnagent.errors.GatewayAuthorizationError.prototype.serialize</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.GatewayAuthorizationError.prototype.serialize.serialize">
            function <span class="apidocSignatureSpan">apnagent.errors.GatewayAuthorizationError.prototype.</span>serialize
            <span class="apidocSignatureSpan">(stack)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.errors.GatewayMessageError">module apnagent.errors.GatewayMessageError</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.GatewayMessageError.GatewayMessageError">
            function <span class="apidocSignatureSpan">apnagent.errors.</span>GatewayMessageError
            <span class="apidocSignatureSpan">(message, props, ssf)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.errors.GatewayMessageError.prototype">module apnagent.errors.GatewayMessageError.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.GatewayMessageError.prototype.constructor">
            function <span class="apidocSignatureSpan">apnagent.errors.GatewayMessageError.prototype.</span>constructor
            <span class="apidocSignatureSpan">(message, props, ssf)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.GatewayMessageError.prototype.serialize">
            function <span class="apidocSignatureSpan">apnagent.errors.GatewayMessageError.prototype.</span>serialize
            <span class="apidocSignatureSpan">(stack)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.GatewayMessageError.prototype.toJSON">
            function <span class="apidocSignatureSpan">apnagent.errors.GatewayMessageError.prototype.</span>toJSON
            <span class="apidocSignatureSpan">(stack)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">apnagent.errors.GatewayMessageError.prototype.</span>name</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.errors.GatewayMessageError.prototype.serialize">module apnagent.errors.GatewayMessageError.prototype.serialize</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.GatewayMessageError.prototype.serialize.serialize">
            function <span class="apidocSignatureSpan">apnagent.errors.GatewayMessageError.prototype.</span>serialize
            <span class="apidocSignatureSpan">(stack)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.errors.MessageSerializationError">module apnagent.errors.MessageSerializationError</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.MessageSerializationError.MessageSerializationError">
            function <span class="apidocSignatureSpan">apnagent.errors.</span>MessageSerializationError
            <span class="apidocSignatureSpan">(message, props, ssf)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.errors.MessageSerializationError.prototype">module apnagent.errors.MessageSerializationError.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.MessageSerializationError.prototype.constructor">
            function <span class="apidocSignatureSpan">apnagent.errors.MessageSerializationError.prototype.</span>constructor
            <span class="apidocSignatureSpan">(message, props, ssf)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.MessageSerializationError.prototype.serialize">
            function <span class="apidocSignatureSpan">apnagent.errors.MessageSerializationError.prototype.</span>serialize
            <span class="apidocSignatureSpan">(stack)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.MessageSerializationError.prototype.toJSON">
            function <span class="apidocSignatureSpan">apnagent.errors.MessageSerializationError.prototype.</span>toJSON
            <span class="apidocSignatureSpan">(stack)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">apnagent.errors.MessageSerializationError.prototype.</span>name</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.apnagent.errors.MessageSerializationError.prototype.serialize">module apnagent.errors.MessageSerializationError.prototype.serialize</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.apnagent.errors.MessageSerializationError.prototype.serialize.serialize">
            function <span class="apidocSignatureSpan">apnagent.errors.MessageSerializationError.prototype.</span>serialize
            <span class="apidocSignatureSpan">(stack)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent" id="apidoc.module.apnagent">module apnagent</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Agent" id="apidoc.element.apnagent.Agent">
        function <span class="apidocSignatureSpan">apnagent.</span>Agent
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Agent() {
  Base.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super" id="apidoc.element.apnagent.Agent._super">
        function <span class="apidocSignatureSpan">apnagent.</span>Agent._super
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Base() {
  EventEmitter.call(this, { delimeter: ':' });
  this.connected = false;

  // default settings
  this.set('cache ttl', '10m');
  this.set('codec', 'enhanced');
  this.set('expires', 0);
  this.enable('reconnect');
  this.set('reconnect delay', 3000);
  this.disable('sandbox');

  // internal storage
  this.meta = {};
  this.meta.lastId = -1;
  this.meta.gatewayError = null;
  this.meta.timer = null;

  var self = this
    , cache, decoder, encoder, queue;

  // temp storage for messages
  cache = new Cache();

  // queue handles writing buffers to gateway
  queue = new Queue(function () {
    debug('(queue) iterate');
    self._queueIterator.apply(self, arguments);
  }, 1);

  // start in paused state
  cache.pause();
  queue.pause();

  // emit queue errors on agent
  queue.onerror = function (err) {
    debug('(queue) error: %s', err.message);
    self.emit('queue:error', err);
  };

  // emit queue drain on agent
  queue.drain = function () {
    debug('(queue) drain');
    self.emit('queue:drain');
  };

  // decoder handles incoming apn errors
  decoder = lotus.createDecoder();
  decoder.stream(8, codecs.getInterface('gateway response', 'decode'));

  // listen for responses
  decoder.stream(8).on('readable', function () {
    var obj = this.read();
    obj.code = obj.code[0];

    var message = notifErrors[obj.code] || 'None (unknown)'
      , err = new errors.GatewayMessageError(message, obj)
      , cached = self.cache.get(obj.identifier)
      , msg = null;

    if (cached) {
      msg = new Message(self, 'enhanced', cached.json.payload);
      msg.device(cached.json.deviceToken);
      msg.meta.expires = cached.json.expiration;
    }

    debug('(message) error: %s', err.message);
    self.meta.gatewayError = err;
    self.emit('message:error', err, msg);
  });

  // encoder handles converting msg json to buffers
  encoder = lotus.createEncoder();
  encoder.stream(0, codecs.getInterface('gateway simple', 'encode'));
  encoder.stream(1, codecs.getInterface('gateway enhanced', 'encode'));

  // mount objects
  this.cache = cache;
  this.decoder = decoder;
  this.encoder = encoder;
  this.gateway = null;
  this.queue = queue;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype._queueIterator" id="apidoc.element.apnagent.Agent._super.prototype._queueIterator">
        function <span class="apidocSignatureSpan">apnagent.</span>Agent._super.prototype._queueIterator
        <span class="apidocSignatureSpan">(buf, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Agent._super.prototype._queueIterator = function (buf, next) {
  throw new Error('Queue iterator not implemented.');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.close" id="apidoc.element.apnagent.Agent._super.prototype.close">
        function <span class="apidocSignatureSpan">apnagent.</span>Agent._super.prototype.close
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Agent._super.prototype.close = function () {
  throw new Error('Gateway close not implemented');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.connect" id="apidoc.element.apnagent.Agent._super.prototype.connect">
        function <span class="apidocSignatureSpan">apnagent.</span>Agent._super.prototype.connect
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Agent._super.prototype.connect = function () {
  throw new Error('Gateway connect not implemented.');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.createMessage" id="apidoc.element.apnagent.Agent._super.prototype.createMessage">
        function <span class="apidocSignatureSpan">apnagent.</span>Agent._super.prototype.createMessage
        <span class="apidocSignatureSpan">(enc)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Agent._super.prototype.createMessage = function (enc) {
  var codec = this.get('codec');
  return new Message(this, codec, { enc: enc });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.disable" id="apidoc.element.apnagent.Agent._super.prototype.disable">
        function <span class="apidocSignatureSpan">apnagent.</span>Agent._super.prototype.disable
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Agent._super.prototype.disable = function (key) {
  return this.set(key, false);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.disabled" id="apidoc.element.apnagent.Agent._super.prototype.disabled">
        function <span class="apidocSignatureSpan">apnagent.</span>Agent._super.prototype.disabled
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Agent._super.prototype.disabled = function (key) {
  return !!! this.get(key);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.enable" id="apidoc.element.apnagent.Agent._super.prototype.enable">
        function <span class="apidocSignatureSpan">apnagent.</span>Agent._super.prototype.enable
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Agent._super.prototype.enable = function (key) {
  return this.set(key, true);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.enabled" id="apidoc.element.apnagent.Agent._super.prototype.enabled">
        function <span class="apidocSignatureSpan">apnagent.</span>Agent._super.prototype.enabled
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Agent._super.prototype.enabled = function (key) {
  return !! this.get(key);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.get" id="apidoc.element.apnagent.Agent._super.prototype.get">
        function <span class="apidocSignatureSpan">apnagent.</span>Agent._super.prototype.get
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Agent._super.prototype.get = function (key) {
  return this.set(key);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.nextId" id="apidoc.element.apnagent.Agent._super.prototype.nextId">
        function <span class="apidocSignatureSpan">apnagent.</span>Agent._super.prototype.nextId
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Agent._super.prototype.nextId = function () {
  var i = ++this.meta.lastId;

  if (i &gt; INT32) {
    i = this.meta.lastId = 0;
  }

  return i;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.send" id="apidoc.element.apnagent.Agent._super.prototype.send">
        function <span class="apidocSignatureSpan">apnagent.</span>Agent._super.prototype.send
        <span class="apidocSignatureSpan">(msg, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Agent._super.prototype.send = function (msg, cb) {
  cb = cb || function () {};

  var self = this
    , codecStr = msg.meta.codec
    , codec = codecs.getId('gateway ' + codecStr)
    , json;

  // handle error
  function error (err) {
    process.nextTick(function () {
      debug('(message) error: %s', err.message);
      cb(err);
      self.emit('message:error', err, msg);
    });
  }

  // check for codec
  if (!~[ 0, 1 ].indexOf(codec)) {
    error(new errors.SerializationError('Invalid codec: ' + codecStr));
    return this;
  }

  // serialize the message
  try {
    json = msg.serialize();
  } catch (ex) {
    error(ex);
    return this;
  }

  // write json to to the queue
  debug('(queue) push: %d', json.identifier);
  this.queue.push({ codec: codec, json: json }, cb, true);
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.set" id="apidoc.element.apnagent.Agent._super.prototype.set">
        function <span class="apidocSignatureSpan">apnagent.</span>Agent._super.prototype.set
        <span class="apidocSignatureSpan">(key, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Agent._super.prototype.set = function (key, value) {
  var settings = this[prop] || (this[prop] = {});

  if (1 === arguments.length) {
    if ('string' === typeof key) {
      return settings[key];
    } else {
      for (var name in key) {
        this.set(name, key[name]);
      }
    }
  } else {
    settings[key] = value;
    handle.call(this, key, value);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent.prototype._queueIterator" id="apidoc.element.apnagent.Agent.prototype._queueIterator">
        function <span class="apidocSignatureSpan">apnagent.</span>Agent.prototype._queueIterator
        <span class="apidocSignatureSpan">(obj, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Agent.prototype._queueIterator = function (obj, next) {
  var self = this
    , cache = this.cache
    , encoder = this.encoder
    , stream = encoder.stream(obj.codec)
    , id = obj.json.identifier
    , queue = this.queue;

  // wait for encoded message
  encoder.once('readable', function () {
    var buf = encoder.read()
      , gateway = self.gateway;

    // requeue if not connected
    if (!gateway || !gateway.writable || !self.connected) {
      debug('(queue) pause: not connected');
      queue.pause();
      queue.pushAt(0, obj);
      return next();
    }

    debug('(gateway) write: %d', id);
    gateway.write(buf, function () {
      debug('(cache) push: %d', id);
      cache.push(id, obj);
      next();
    });
  });

  // encode message
  debug('(encoder) write: %d', id);
  stream.write(obj.json);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent.prototype._reconnect" id="apidoc.element.apnagent.Agent.prototype._reconnect">
        function <span class="apidocSignatureSpan">apnagent.</span>Agent.prototype._reconnect
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Agent.prototype._reconnect = function (){
  var self = this
    , gwe = self.meta.gatewayError
    , pos = 0;

  if (gwe &amp;&amp; 'undefined' !== typeof gwe.identifier) {
    debug('(cache) since: %d', gwe.identifier);
    self.cache.sinceId(gwe.identifier, function (obj, id) {
      debug('(queue) push: %d', id);
      self.queue.pushAt(pos++, obj);
    });
  }

  debug('(gateway) reconnecting');
  self.connect(function (err) {
    if (err) return;
    debug('(gateway) reconnected');
    self.emit('gateway:reconnect');
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent.prototype.close" id="apidoc.element.apnagent.Agent.prototype.close">
        function <span class="apidocSignatureSpan">apnagent.</span>Agent.prototype.close
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Agent.prototype.close = function (cb) {
  cb = cb || function () {};

  // leave if nothing needs to be done
  if (!this.connected || !this.gateway) {
    clearTimeout(this.meta.timer);
    process.nextTick(cb);
    return this;
  }

  var self = this
    , drain = this.queue.drain;

  // wait for queue to finish processing current
  this.queue.drain = function () {
    debug('(gateway) disconnecting');
    self.cache.pause();
    self.gateway.once('close', cb);
    self.gateway.destroy();
    self.queue.drain = drain;
  };

  // set things in motion
  this.connected = false;
  this.queue.pause();
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent.prototype.connect" id="apidoc.element.apnagent.Agent.prototype.connect">
        function <span class="apidocSignatureSpan">apnagent.</span>Agent.prototype.connect
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Agent.prototype.connect = function (cb) {
  cb = cb || function () {};

  var self = this
    , delay = this.get('reconnect delay')
    , opts = util.gatewayOptions(this)
    , recon = this.enabled('reconnect')
    , ttl = this.get('cache ttl')
    , gateway;

  // don't try to connect without credentials
  if (!opts.pfx &amp;&amp; !opts.key &amp;&amp; !opts.cert) {
    process.nextTick(function () {
      var err = new errors.GatewayAuthorizationError('Insufficient credentials');
      debug('(gateway) error: %s', err.message);
      self.emit('gateway:error', err);
      cb(err);
    });

    return this;
  }

  // reset state
  this.meta.gatewayError = null;

  // connect to gateway
  debug('(gateway) connecting - %s:%d', opts.host, opts.port);
  gateway = tls.connect(opts, function () {
    if (gateway.authorized) {
      debug('(gateway) connected - %s:%d', opts.host, opts.port);
      self.connected = true;
      self.cache.ttl = ttl;
      self.cache.resume();
      self.queue.resume();
      self.emit('gateway:connect');
      cb();
    } else {
      var err = new errors.GatewayAuthorizationError(gateway.authorizationError);
      debug('(gateway) unauthorized - %s:%d', opts.host, opts.port, gateway.authorizationError);
      self.gateway.destroy();
      self.emit('gateway:error', err);
      cb(err);
    }
  });

  // handle a disconnection
  gateway.on('close', function () {
    self.cache.pause();
    self.queue.pause();
    self.gateway = null;

    if (self.connected &amp;&amp; recon) {
      debug('(gateway) disconnected - %s:%d', opts.host, opts.port);
      self.connected = false;
      self.meta.timer = setTimeout(self._reconnect.bind(self), ms(delay));
    } else {
      debug('(gateway) closed - %s:%d', opts.host, opts.port);
      self.connected = false;
      self.emit('gateway:close');
    }
  });

  // handle incoming data
  gateway.on('data', function (buf) {
    debug('(gateway) data: %d bytes', buf.length);
    self.decoder.write(buf);
  });

  // emit errors;
  gateway.on('error', function (err) {
    debug('(gateway) error: %s', err.message || 'Unspecified Error');
    if (self.gateway) self.gateway.destroy();
    self.emit('gateway:error', err);
  });

  // mount
  this.gateway = gateway;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Device" id="apidoc.element.apnagent.Device">
        function <span class="apidocSignatureSpan">apnagent.</span>Device
        <span class="apidocSignatureSpan">(token)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Device(token) {
<span class="apidocCodeCommentSpan">  /*!
   * @param {String|Buffer|Device} device token
   * @api public
   */
</span>  if (token instanceof Device) {
    token = token.toString();
  }

  this.token = token || undefined;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Device.prototype.equal" id="apidoc.element.apnagent.Device.prototype.equal">
        function <span class="apidocSignatureSpan">apnagent.</span>Device.prototype.equal
        <span class="apidocSignatureSpan">(dev)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Device.prototype.equal = function (dev) {
  var token1 = this.toString()
    , token2 = dev instanceof Device
      ? dev.toString()
      : stringify(dev);

  return token1
    &amp;&amp; token2
    &amp;&amp; token1 === token2;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Device.prototype.toBuffer" id="apidoc.element.apnagent.Device.prototype.toBuffer">
        function <span class="apidocSignatureSpan">apnagent.</span>Device.prototype.toBuffer
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Device.prototype.toBuffer = function () {
  return bufferize(this.token);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Device.prototype.toString" id="apidoc.element.apnagent.Device.prototype.toString">
        function <span class="apidocSignatureSpan">apnagent.</span>Device.prototype.toString
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Device.prototype.toString = function () {
  return stringify(this.token);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Feedback" id="apidoc.element.apnagent.Feedback">
        function <span class="apidocSignatureSpan">apnagent.</span>Feedback
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Feedback() {
  Base.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super" id="apidoc.element.apnagent.Feedback._super">
        function <span class="apidocSignatureSpan">apnagent.</span>Feedback._super
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Base() {
  EventEmitter.call(this, { delimeter: ':' });
  this.connected = false;
  this.set('interval', '30m');
  this.disable('sandbox');

  this.meta = {};
  this.meta.timer = null;
  this.meta.stack = [ emit ];

  var self = this
    , decoder, queue;

  // queue handles user interaction with responses
  queue = new Queue(function (obj, done) {
    var device = obj.device
      , stack = self.meta.stack
      , timestamp = obj.timestamp;

    // intercept errors so as not to cancel queue
    function finish (err) {
      if (err) {
        debug('(iterate) error - %s', err.message);
        self.emit('iterate:error', err, device, timestamp);
      }

      debug('(iterate) end - %s', device.toString());
      done();
    }

    // start iteration
    debug('(iterate) start - %s', device.toString());
    series(stack, function (fn, next) {
      fn.apply(self, [ device, timestamp, next ]);
    }, finish);
  }, 10);

  // emit queue errors on feedback agent
  queue.onerror = function (err) {
    debug('(queue) error: %s', err.message);
    self.emit('queue:error', err);
  };

  // emit queue drain on feedback agent
  queue.drain = function () {
    debug('(queue) drain');
    self.emit('queue:drain');
  };

  // decoder handing incoming feedback responses
  decoder = lotus.createDecoder();
  decoder.stream(codecs.getInterface('feedback response', 'decode'));
  decoder.stream().on('readable', function () {
    var obj = this.read()
      , res = {};
    res.device = new Device(obj.deviceToken);
    res.timestamp = new Date(obj.timestamp * 1000);
    queue.push(res, true);
  });

  this.decoder = decoder;
  this.feedback = null;
  this.queue = queue;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.close" id="apidoc.element.apnagent.Feedback._super.prototype.close">
        function <span class="apidocSignatureSpan">apnagent.</span>Feedback._super.prototype.close
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Feedback._super.prototype.close = function () {
  throw new Error('Feedback close not implemented.');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.connect" id="apidoc.element.apnagent.Feedback._super.prototype.connect">
        function <span class="apidocSignatureSpan">apnagent.</span>Feedback._super.prototype.connect
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Feedback._super.prototype.connect = function () {
  throw new Error('Feedback connect not implemented.');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.disable" id="apidoc.element.apnagent.Feedback._super.prototype.disable">
        function <span class="apidocSignatureSpan">apnagent.</span>Feedback._super.prototype.disable
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Feedback._super.prototype.disable = function (key) {
  return this.set(key, false);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.disabled" id="apidoc.element.apnagent.Feedback._super.prototype.disabled">
        function <span class="apidocSignatureSpan">apnagent.</span>Feedback._super.prototype.disabled
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Feedback._super.prototype.disabled = function (key) {
  return !!! this.get(key);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.enable" id="apidoc.element.apnagent.Feedback._super.prototype.enable">
        function <span class="apidocSignatureSpan">apnagent.</span>Feedback._super.prototype.enable
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Feedback._super.prototype.enable = function (key) {
  return this.set(key, true);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.enabled" id="apidoc.element.apnagent.Feedback._super.prototype.enabled">
        function <span class="apidocSignatureSpan">apnagent.</span>Feedback._super.prototype.enabled
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Feedback._super.prototype.enabled = function (key) {
  return !! this.get(key);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.get" id="apidoc.element.apnagent.Feedback._super.prototype.get">
        function <span class="apidocSignatureSpan">apnagent.</span>Feedback._super.prototype.get
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Feedback._super.prototype.get = function (key) {
  return this.set(key);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.set" id="apidoc.element.apnagent.Feedback._super.prototype.set">
        function <span class="apidocSignatureSpan">apnagent.</span>Feedback._super.prototype.set
        <span class="apidocSignatureSpan">(key, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Feedback._super.prototype.set = function (key, value) {
  var settings = this[prop] || (this[prop] = {});

  if (1 === arguments.length) {
    if ('string' === typeof key) {
      return settings[key];
    } else {
      for (var name in key) {
        this.set(name, key[name]);
      }
    }
  } else {
    settings[key] = value;
    handle.call(this, key, value);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.unsub" id="apidoc.element.apnagent.Feedback._super.prototype.unsub">
        function <span class="apidocSignatureSpan">apnagent.</span>Feedback._super.prototype.unsub
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Feedback._super.prototype.unsub = function () {}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.use" id="apidoc.element.apnagent.Feedback._super.prototype.use">
        function <span class="apidocSignatureSpan">apnagent.</span>Feedback._super.prototype.use
        <span class="apidocSignatureSpan">(fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Feedback._super.prototype.use = function (fn) {
  this.meta.stack.push(fn);
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Feedback.prototype.close" id="apidoc.element.apnagent.Feedback.prototype.close">
        function <span class="apidocSignatureSpan">apnagent.</span>Feedback.prototype.close
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Feedback.prototype.close = function (cb) {
  cb = cb || function () {};

  // if not connected, cancel reconnect time
  if (!this.connected || !this.feedback) {
    clearTimeout(this.meta.timer);
    process.nextTick(cb);
    return this;
  }

  // wait for feedback to finish download
  this.feedback.once('end', cb);
  this.connected = false;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Feedback.prototype.connect" id="apidoc.element.apnagent.Feedback.prototype.connect">
        function <span class="apidocSignatureSpan">apnagent.</span>Feedback.prototype.connect
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Feedback.prototype.connect = function (cb) {
  cb = cb || function () {};

  var self = this
    , interval = this.get('interval')
    , opts = util.feedbackOptions(this)
    , feedback;

  // don't try to connect without credentials
  if (!opts.pfx &amp;&amp; !opts.key &amp;&amp; !opts.cert) {
    process.nextTick(function () {
      var err = new errors.FeedbackAuthorizationError('Insufficient credentials');
      debug('(feedback) error: %s', err.message);
      self.emit('feedback:error', err);
      cb(err);
    });

    return this;
  }

  // how to perform a reconnect
  function reconnect () {
    debug('(feedback) reconnecting');
    self.connect(function (err) {
      if (err) return;
      debug('(feedback) reconnected');
      self.emit('feedback:reconnect');
    });
  }

  // connect to feedback service
  feedback = tls.connect(opts, function () {
    if (feedback.authorized) {
      debug('(feedback) connected - %s:%d', opts.host, opts.port);
      self.connected = true;
      self.emit('feedback:connect');
      cb();
    } else {
      var err = new error.FeedbackAuthorizationError(gateway.authorizationError);
      debug('(feedback) unauthorized - %s:%d', opts.host, opts.port, gateway.authorizationError);
      self.feedback.destroy();
      self.emit('gateway:error', err);
      cb(err);
    }
  });

  // handle a disconnection (expected)
  feedback.on('close', function () {
    self.feedback = null;

    if (self.connected) {
      debug('(feedback) disconnected - %s:%d', opts.host, opts.port);
      self.connected = false;
      self.meta.timer = setTimeout(reconnect, ms(interval));
    } else {
      debug('(feedback) closed - %s:%d', opts.host, opts.port);
      self.connected = false;
      self.emit('feedback:close');
    }
  });

  // handle incoming data
  feedback.on('data', function (buf) {
    debug('(feedback) data: %d bytes', buf.length);
    self.decoder.write(buf);
  });

  // emit errors;
  feedback.on('error', function (err) {
    debug('(feedback) error: %s', err.message || 'Unspecified Error');
    self.emit('feedback:error', err);
  });

  // mount
  this.feedback = feedback;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.MockAgent" id="apidoc.element.apnagent.MockAgent">
        function <span class="apidocSignatureSpan">apnagent.</span>MockAgent
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Mock() {
  Base.call(this);

  // Messages sent to these devices will be rejected with error 8 BAD_TOKEN
  this.badDevices = []
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.MockAgent.prototype._queueIterator" id="apidoc.element.apnagent.MockAgent.prototype._queueIterator">
        function <span class="apidocSignatureSpan">apnagent.</span>MockAgent.prototype._queueIterator
        <span class="apidocSignatureSpan">(obj, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">MockAgent.prototype._queueIterator = function (obj, next) {
  var self = this
    , cache = this.cache
    , encoder = this.encoder
    , stream = encoder.stream(obj.codec)
    , id = obj.json.identifier
    , queue = this.queue;

  // wait for encoded message
  encoder.once('readable', function () {
    var buf = encoder.read()
      , gateway = self.gateway;

    // requeue if not connected
    if (!gateway || !gateway.writable || !self.connected) {
      debug('(queue) pause: not connected');
      queue.pause();
      queue.pushAt(0, obj);
      return next();
    }

    debug('(gateway) write: %d', id);
    gateway.write(buf);
    process.nextTick(function () {
      debug('(cache) push: %d', id);
      cache.push(id, obj);
      next();
    });
  });

  // encode message
  debug('(encoder) write: %d', id);
  stream.write(obj.json);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.MockAgent.prototype.close" id="apidoc.element.apnagent.MockAgent.prototype.close">
        function <span class="apidocSignatureSpan">apnagent.</span>MockAgent.prototype.close
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">MockAgent.prototype.close = function (cb) {
  cb = cb || function () {};

  // leave if nothing needs to be done
  if (!this.connected || !this.gateway) {
    clearTimeout(this.meta.timer);
    process.nextTick(cb);
    return this;
  }

  var self = this
    , drain = this.queue.drain;

  // wait for queue to finish processing current
  this.queue.drain = function () {
    debug('(gateway) disconnecting');
    self.cache.pause();
    process.nextTick(cb);
    self.gateway.end();
    self.queue.drain = drain;
  };

  // set things in motion
  this.connected = false;
  this.queue.pause();
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.MockAgent.prototype.connect" id="apidoc.element.apnagent.MockAgent.prototype.connect">
        function <span class="apidocSignatureSpan">apnagent.</span>MockAgent.prototype.connect
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">MockAgent.prototype.connect = function (cb) {
  cb = cb || function () {};

  var self = this
    , delay = this.get('reconnect delay')
    , opts = util.gatewayOptions(this)
    , recon = this.enabled('reconnect')
    , ttl = this.get('cache ttl')
    , gateway;

  // how to perform a reconnect
  function reconnect () {
    var gwe = self.meta.gatewayError
      , pos = 0;

    if (gwe &amp;&amp; 'undefined' !== typeof gwe.identifier) {
      debug('(cache) since: %d', gwe.identifier);
      self.cache.sinceId(gwe.identifier, function (obj, id) {
        debug('(queue) push: %d', id);
        self.queue.pushAt(pos++, obj);
      });
    }

    debug('(gateway) reconnecting');
    self.connect(function (err) {
      if (err) return;
      debug('(gateway) reconnected');
      self.emit('gateway:reconnect');
    });
  }

  // reset state
  this.meta.gatewayError = null;

  // mock gateway parses the outgoing buffers back to json
  gateway = lotus.createDecoder();
  gateway.stream(0, codecs.getInterface('gateway simple', 'decode'));
  gateway.stream(1, codecs.getInterface('gateway enhanced', 'decode'));

  // simulate async connect
  debug('(gateway) connecting - mock');
  process.nextTick(function () {
    debug('(gateway) connected - mock');
    self.connected = true;
    self.cache.ttl = ttl;
    self.cache.resume();
    self.queue.resume();
    self.emit('gateway:connect');
    cb();
  });

  function shouldBeRejected (msgJson) {
    msgDevice = new Device(msgJson.deviceToken);
    reject = false;
    for (var i = 0; i &lt; self.badDevices.length; i++) {
      reject = self.badDevices[i].equal(msgDevice)
    }
    return reject;
  }

  // data event is emitted for each message
  function emitter () {
    var json = this.read();
    if (!json) return;

    // Simulate message error at Apple side
    if (shouldBeRejected(json)) {
      var err = new errors.GatewayMessageError("Invalid token", {code: 8})
      self.meta.gatewayError = err;

      debug('(gateway) incoming message error', err.toJSON(false));
      self.emit('message:error', err, json);
      gateway.end();
    } else {
      debug('(gateway) incoming message', json);
      self.emit('mock:message', json);
    }
  }

  gateway.stream(0).on('readable', emitter);
  gateway.stream(1).on('readable', emitter);

  // an error is emitted when an incoming message is badly formatted
  gateway.on('error', function (err) {
    debug('(gateway) error: %s', err.message || 'Unspecified Error');
    self.emit('gateway:error', err);
  });

  // this is similiar to a socket `close` event
  gateway.on('close', function () {
    self.cache.pause();
    self.queue.pause();
    self.gateway = null;

    if (self.connected &amp;&amp; recon) {
      debug('(gateway) disconnected - mock');
      self.connected = false;
      self.meta.timer = setTimeout(reconnect, ms(delay));
    } else {
      debug('(gateway) closed - mock');
      self.connected = false;
      self.emit('gateway:close');
    }
  });

  // mount
  this.gateway = gateway;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.MockAgent.prototype.setBadDevices" id="apidoc.element.apnagent.MockAgent.prototype.setBadDevices">
        function <span class="apidocSignatureSpan">apnagent.</span>MockAgent.prototype.setBadDevices
        <span class="apidocSignatureSpan">(devices)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">MockAgent.prototype.setBadDevices = function (devices) {
  // Validate input, crash early if smth is wrong -
  // better than search for a bug somewhere deep in code
  if (!(devices instanceof Array)) {
    throw new Error('Parameter "devices" should be an array of Device');
  } else {
    for (var i = 0; i &lt; devices.length; i++) {
      if (!(devices[i] instanceof Device)) {
        throw new Error('Parameter "devices" should be an array of Device')
      }
    }
  }

  // All good
  this.badDevices = devices;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.MockFeedback" id="apidoc.element.apnagent.MockFeedback">
        function <span class="apidocSignatureSpan">apnagent.</span>MockFeedback
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Mock() {
  Base.call(this);
  this.meta.outgoing = [];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.MockFeedback.prototype.close" id="apidoc.element.apnagent.MockFeedback.prototype.close">
        function <span class="apidocSignatureSpan">apnagent.</span>MockFeedback.prototype.close
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">MockFeedback.prototype.close = function (cb) {
  cb = cb || function () {};

  // if not connected, cancel reconnect time
  if (!this.connected || !this.feedback) {
    clearTimeout(this.meta.timer);
    process.nextTick(cb);
    return this;
  }

  // wait for feedback to finish download
  this.feedback.once('end', cb);
  this.connected = false;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.MockFeedback.prototype.connect" id="apidoc.element.apnagent.MockFeedback.prototype.connect">
        function <span class="apidocSignatureSpan">apnagent.</span>MockFeedback.prototype.connect
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">MockFeedback.prototype.connect = function (cb) {
  cb = cb || function () {};

  var self = this
    , interval = this.get('interval')
    , opts = util.feedbackOptions(this)
    , feedback;

  // how to perform a reconnect
  function reconnect () {
    debug('(feedback) reconnecting');
    self.connect(function (err) {
      if (err) return;
      debug('(feedback) reconnected');
      self.emit('feedback:reconnect');
    });
  }

  // mock feedback writes mock unsubs to decoder
  feedback = lotus.createEncoder();
  feedback.stream(codecs.getInterface('feedback response', 'encode'));

  // simulate async connect
  debug('(feedback) connecting - mock');
  process.nextTick(function () {
    debug('(feedback) connected - mock');
    self.connected = true;
    self.emit('feedback:connect');
    cb();

    // send simulated data
    setTimeout(function () {
      var outgoing = self.meta.outgoing
        , stream = feedback.stream()
        , line;

      debug('(mock) simulating [%d] unsubs', outgoing.length);
      while (outgoing.length) {
        line = outgoing.shift();
        debug('(mock) writing unsub - %s', line.deviceToken.toString('hex'));
        stream.write(line);
      }

      debug('(mock) writing complete');
      stream.end();
    }, 10);
  });

  // handle "incoming" data
  feedback.on('data', function (buf) {
    debug('(feedback) data: %d bytes, buf.length');
    self.decoder.write(buf);
  });

  // emit errors;
  feedback.on('error', function (err) {
    debug('(feedback) error: %s', err.message || 'Unspecified Error');
    self.emit('feedback:error', err);
  });

  // end is similiar to a socket `close` event
  feedback.on('end', function () {
    self.feedback = null;

    if (self.connected) {
      debug('(feedback) disconnected - %s:%d', opts.host, opts.port);
      self.connected = false;
      self.meta.timer = setTimeout(reconnect, ms(interval));
    } else {
      debug('(feedback) closed - %s:%d', opts.host, opts.port);
      self.connected = false;
      self.emit('feedback:close');
    }
  });

  // mount
  this.feedback = feedback;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.MockFeedback.prototype.unsub" id="apidoc.element.apnagent.MockFeedback.prototype.unsub">
        function <span class="apidocSignatureSpan">apnagent.</span>MockFeedback.prototype.unsub
        <span class="apidocSignatureSpan">(token, ts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">MockFeedback.prototype.unsub = function (token, ts) {
  var device = new Device(token)
    , timestamp;

  // figure out time
  if (ts &amp;&amp; 'number' === typeof ts) {
    timestamp = ts;
  } else if (ts &amp;&amp; 'string' === typeof ts) {
    timestamp = ms.unix(ts);
  } else if (ts &amp;&amp; ts instanceof Date) {
    timestamp = ts.getTime() / 1000;
  } else {
    timestamp = ms.unix('-1s');
  }

  // add to outgoing queue
  this.meta.outgoing.push({
      deviceToken: device.toBuffer()
    , timestamp: timestamp
  });

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.errors.FeedbackAuthorizationError" id="apidoc.element.apnagent.errors.FeedbackAuthorizationError">
        function <span class="apidocSignatureSpan">apnagent.</span>errors.FeedbackAuthorizationError
        <span class="apidocSignatureSpan">(message, props, ssf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ErrorProto(message, props, ssf) {
  var exclude = extend.exclude('name', 'message', 'stack')
    , props = exclude(props || {});

  this.message = message || ('Unspecified ' + name);
  extend(this, props);

  ssf = ssf || arguments.callee;
  if (ssf &amp;&amp; Error.captureStackTrace) {
    Error.captureStackTrace(this, ssf);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.errors.FeedbackAuthorizationError.prototype.serialize" id="apidoc.element.apnagent.errors.FeedbackAuthorizationError.prototype.serialize">
        function <span class="apidocSignatureSpan">apnagent.</span>errors.FeedbackAuthorizationError.prototype.serialize
        <span class="apidocSignatureSpan">(stack)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">errors.FeedbackAuthorizationError.prototype.serialize = function (stack) {
  var exclude = extend.exclude('constructor', 'serialize', 'toJSON', 'stack')
    , props = exclude({ name: this.name }, this);

  if (false !== stack &amp;&amp; this.stack) {
    props.stack = this.stack;
  }

  return props;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.errors.GatewayAuthorizationError" id="apidoc.element.apnagent.errors.GatewayAuthorizationError">
        function <span class="apidocSignatureSpan">apnagent.</span>errors.GatewayAuthorizationError
        <span class="apidocSignatureSpan">(message, props, ssf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ErrorProto(message, props, ssf) {
  var exclude = extend.exclude('name', 'message', 'stack')
    , props = exclude(props || {});

  this.message = message || ('Unspecified ' + name);
  extend(this, props);

  ssf = ssf || arguments.callee;
  if (ssf &amp;&amp; Error.captureStackTrace) {
    Error.captureStackTrace(this, ssf);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.errors.GatewayAuthorizationError.prototype.serialize" id="apidoc.element.apnagent.errors.GatewayAuthorizationError.prototype.serialize">
        function <span class="apidocSignatureSpan">apnagent.</span>errors.GatewayAuthorizationError.prototype.serialize
        <span class="apidocSignatureSpan">(stack)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">errors.GatewayAuthorizationError.prototype.serialize = function (stack) {
  var exclude = extend.exclude('constructor', 'serialize', 'toJSON', 'stack')
    , props = exclude({ name: this.name }, this);

  if (false !== stack &amp;&amp; this.stack) {
    props.stack = this.stack;
  }

  return props;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.errors.GatewayMessageError" id="apidoc.element.apnagent.errors.GatewayMessageError">
        function <span class="apidocSignatureSpan">apnagent.</span>errors.GatewayMessageError
        <span class="apidocSignatureSpan">(message, props, ssf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ErrorProto(message, props, ssf) {
  var exclude = extend.exclude('name', 'message', 'stack')
    , props = exclude(props || {});

  this.message = message || ('Unspecified ' + name);
  extend(this, props);

  ssf = ssf || arguments.callee;
  if (ssf &amp;&amp; Error.captureStackTrace) {
    Error.captureStackTrace(this, ssf);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.errors.GatewayMessageError.prototype.serialize" id="apidoc.element.apnagent.errors.GatewayMessageError.prototype.serialize">
        function <span class="apidocSignatureSpan">apnagent.</span>errors.GatewayMessageError.prototype.serialize
        <span class="apidocSignatureSpan">(stack)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">errors.GatewayMessageError.prototype.serialize = function (stack) {
  var exclude = extend.exclude('constructor', 'serialize', 'toJSON', 'stack')
    , props = exclude({ name: this.name }, this);

  if (false !== stack &amp;&amp; this.stack) {
    props.stack = this.stack;
  }

  return props;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.errors.MessageSerializationError" id="apidoc.element.apnagent.errors.MessageSerializationError">
        function <span class="apidocSignatureSpan">apnagent.</span>errors.MessageSerializationError
        <span class="apidocSignatureSpan">(message, props, ssf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ErrorProto(message, props, ssf) {
  var exclude = extend.exclude('name', 'message', 'stack')
    , props = exclude(props || {});

  this.message = message || ('Unspecified ' + name);
  extend(this, props);

  ssf = ssf || arguments.callee;
  if (ssf &amp;&amp; Error.captureStackTrace) {
    Error.captureStackTrace(this, ssf);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.errors.MessageSerializationError.prototype.serialize" id="apidoc.element.apnagent.errors.MessageSerializationError.prototype.serialize">
        function <span class="apidocSignatureSpan">apnagent.</span>errors.MessageSerializationError.prototype.serialize
        <span class="apidocSignatureSpan">(stack)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">errors.MessageSerializationError.prototype.serialize = function (stack) {
  var exclude = extend.exclude('constructor', 'serialize', 'toJSON', 'stack')
    , props = exclude({ name: this.name }, this);

  if (false !== stack &amp;&amp; this.stack) {
    props.stack = this.stack;
  }

  return props;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>






























</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Agent" id="apidoc.module.apnagent.Agent">module apnagent.Agent</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Agent.Agent" id="apidoc.element.apnagent.Agent.Agent">
        function <span class="apidocSignatureSpan">apnagent.</span>Agent
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Agent() {
  Base.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super" id="apidoc.element.apnagent.Agent._super">
        function <span class="apidocSignatureSpan">apnagent.Agent.</span>_super
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Base() {
  EventEmitter.call(this, { delimeter: ':' });
  this.connected = false;

  // default settings
  this.set('cache ttl', '10m');
  this.set('codec', 'enhanced');
  this.set('expires', 0);
  this.enable('reconnect');
  this.set('reconnect delay', 3000);
  this.disable('sandbox');

  // internal storage
  this.meta = {};
  this.meta.lastId = -1;
  this.meta.gatewayError = null;
  this.meta.timer = null;

  var self = this
    , cache, decoder, encoder, queue;

  // temp storage for messages
  cache = new Cache();

  // queue handles writing buffers to gateway
  queue = new Queue(function () {
    debug('(queue) iterate');
    self._queueIterator.apply(self, arguments);
  }, 1);

  // start in paused state
  cache.pause();
  queue.pause();

  // emit queue errors on agent
  queue.onerror = function (err) {
    debug('(queue) error: %s', err.message);
    self.emit('queue:error', err);
  };

  // emit queue drain on agent
  queue.drain = function () {
    debug('(queue) drain');
    self.emit('queue:drain');
  };

  // decoder handles incoming apn errors
  decoder = lotus.createDecoder();
  decoder.stream(8, codecs.getInterface('gateway response', 'decode'));

  // listen for responses
  decoder.stream(8).on('readable', function () {
    var obj = this.read();
    obj.code = obj.code[0];

    var message = notifErrors[obj.code] || 'None (unknown)'
      , err = new errors.GatewayMessageError(message, obj)
      , cached = self.cache.get(obj.identifier)
      , msg = null;

    if (cached) {
      msg = new Message(self, 'enhanced', cached.json.payload);
      msg.device(cached.json.deviceToken);
      msg.meta.expires = cached.json.expiration;
    }

    debug('(message) error: %s', err.message);
    self.meta.gatewayError = err;
    self.emit('message:error', err, msg);
  });

  // encoder handles converting msg json to buffers
  encoder = lotus.createEncoder();
  encoder.stream(0, codecs.getInterface('gateway simple', 'encode'));
  encoder.stream(1, codecs.getInterface('gateway enhanced', 'encode'));

  // mount objects
  this.cache = cache;
  this.decoder = decoder;
  this.encoder = encoder;
  this.gateway = null;
  this.queue = queue;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Agent._super" id="apidoc.module.apnagent.Agent._super">module apnagent.Agent._super</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Agent._super._super" id="apidoc.element.apnagent.Agent._super._super">
        function <span class="apidocSignatureSpan">apnagent.Agent.</span>_super
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EnhancedEmitter(opts) {
  opts = opts || {};
  this._drip = {};
  this._drip.delimeter = opts.delimeter || ':';
  this._drip.wildcard = opts.wildcard || (opts.delimeter ? true : false);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Agent._super._super.prototype" id="apidoc.module.apnagent.Agent._super._super.prototype">module apnagent.Agent._super._super.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Agent._super._super.prototype.addListener" id="apidoc.element.apnagent.Agent._super._super.prototype.addListener">
        function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>addListener
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">addListener = function () {
  var map = this._events || (this._events = {})
    , ev = arguments[0]
    , fn = arguments[1]
    , evs = Array.isArray(ev)
      ? ev.slice(0)
      : ev.split(this._drip.delimeter)
    , store = this._events || (this._events = {});

  function iterate (events, map) {
    var event = events.shift();
    map[event] = map[event] || {};

    if (events.length) {
      iterate(events, map[event]);
    } else {
      if (!map[event]._) map[event]._= [ fn ];
      else map[event]._.push(fn);
    }
  };

  iterate(evs, store);
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super._super.prototype.bindEvent" id="apidoc.element.apnagent.Agent._super._super.prototype.bindEvent">
        function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>bindEvent
        <span class="apidocSignatureSpan">(ev, target)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">bindEvent = function (ev, target) {
  var proxy = eventProxy.call(this, ev, target);
  this.on(ev, proxy);
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super._super.prototype.emit" id="apidoc.element.apnagent.Agent._super._super.prototype.emit">
        function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>emit
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">emit = function () {
  if (!this._events) return false;

  var ev = arguments[0]
    , evs = Array.isArray(ev)
      ? ev.slice(0)
      : ev.split(this._drip.delimeter)
    , fns = traverse(evs, this._events);

  if (!fns.length) return false;

  var a;
  for (var i = 0, l = fns.length; i &lt; l; i++) {
    if (arguments.length === 1) fns[i].call(this);
    else if (arguments.length === 2) fns[i].call(this, arguments[1]);
    else if (arguments.length === 3) fns[i].call(this, arguments[1], arguments[2]);
    else {
      if (!a) {
        var la = arguments.length
        a = Array(la - 1);
        for (var i2 = 1; i2 &lt; la; i2++) a[i2 - 1] = arguments[i2];
      }
      fns[i].apply(this, a);
    }
  }

  return true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super._super.prototype.hasListener" id="apidoc.element.apnagent.Agent._super._super.prototype.hasListener">
        function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>hasListener
        <span class="apidocSignatureSpan">(ev, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">hasListener = function (ev, fn) {
  if (!this._events) return false;
  var evs = Array.isArray(ev)
      ? ev.slice(0)
      : ev.split(this._drip.delimeter)
    , fns = traverse(evs, this._events);
  if (fns.length === 0) return false;
  return common.hasListener(fns, fn);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super._super.prototype.listeners" id="apidoc.element.apnagent.Agent._super._super.prototype.listeners">
        function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>listeners
        <span class="apidocSignatureSpan">(ev)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">listeners = function (ev) {
  if (!this._events) return [];
  var evs = Array.isArray(ev)
      ? ev.slice(0)
      : ev.split(this._drip.delimeter)
    , fns = traverse(evs, this._events);
  return fns;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super._super.prototype.many" id="apidoc.element.apnagent.Agent._super._super.prototype.many">
        function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>many
        <span class="apidocSignatureSpan">(ev, times, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">many = function (ev, times, fn) {
  var self = this;

  function wrap () {
    if (--times === 0) self.off(ev, wrap);
    fn.apply(null, arguments);
  };

  this.on(ev, wrap);
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super._super.prototype.off" id="apidoc.element.apnagent.Agent._super._super.prototype.off">
        function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>off
        <span class="apidocSignatureSpan">(ev, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">off = function (ev, fn) {
  if (!this._events || arguments.length === 0) {
    this._events = {};
    return this;
  }

  var evs = Array.isArray(ev)
      ? ev.slice(0)
      : ev.split(this._drip.delimeter);

  if (evs.length === 1 &amp;&amp; !fn) {
    if (this._events[ev]) this._events[ev]._ = null;
    return this;
  } else {
    function isEmpty (obj) {
      for (var name in obj)
        if (obj[name] &amp;&amp; name != '_') return false;
      return true;
    };

    function clean (event) {
      if (fn &amp;&amp; 'function' === typeof fn) {
        for (var i = 0; i &lt; event._.length; i++)
          if (fn == event._[i]) event._.splice(i, 1);
        if (event._.length === 0) event._ = null;
        if (event._ &amp;&amp; event._.length == 1) event._ = event._[0];
      } else {
        event._ = null;
      }

      if (!event._ &amp;&amp; isEmpty(event)) event = null;
      return event;
    };

    function iterate (events, map) {
      var event = events.shift();
      if (map[event] &amp;&amp; map[event]._ &amp;&amp; !events.length) map[event] = clean(map[event]);
      if (map[event] &amp;&amp; events.length) map[event] = iterate(events, map[event]);
      if (!map[event] &amp;&amp; isEmpty(map)) map = null;
      return map;
    };

    this._events = iterate(evs, this._events);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super._super.prototype.on" id="apidoc.element.apnagent.Agent._super._super.prototype.on">
        function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>on
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">on = function () {
  var map = this._events || (this._events = {})
    , ev = arguments[0]
    , fn = arguments[1]
    , evs = Array.isArray(ev)
      ? ev.slice(0)
      : ev.split(this._drip.delimeter)
    , store = this._events || (this._events = {});

  function iterate (events, map) {
    var event = events.shift();
    map[event] = map[event] || {};

    if (events.length) {
      iterate(events, map[event]);
    } else {
      if (!map[event]._) map[event]._= [ fn ];
      else map[event]._.push(fn);
    }
  };

  iterate(evs, store);
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super._super.prototype.once" id="apidoc.element.apnagent.Agent._super._super.prototype.once">
        function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>once
        <span class="apidocSignatureSpan">(ev, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">once = function (ev, fn) {
  this.many(ev, 1, fn);
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super._super.prototype.proxyEvent" id="apidoc.element.apnagent.Agent._super._super.prototype.proxyEvent">
        function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>proxyEvent
        <span class="apidocSignatureSpan">(ev, ns, target)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">proxyEvent = function (ev, ns, target) {
  if (arguments.length === 2) target = ns, ns = null;
  var drip = this._drip || {}
    , listen = !drip.delimeter
      ? (ns  ? ns + ':' + ev : ev)
      : (ns
        ? (Array.isArray(ns)
          ? concat(ns, [ ev ])
          : concat(ns.split(drip.delimeter), [ ev ]))
        : ev);

  target.addListener(ev, eventProxy.call(this, listen, this));
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super._super.prototype.removeAllListeners" id="apidoc.element.apnagent.Agent._super._super.prototype.removeAllListeners">
        function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>removeAllListeners
        <span class="apidocSignatureSpan">(ev, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">removeAllListeners = function (ev, fn) {
  if (!this._events || arguments.length === 0) {
    this._events = {};
    return this;
  }

  var evs = Array.isArray(ev)
      ? ev.slice(0)
      : ev.split(this._drip.delimeter);

  if (evs.length === 1 &amp;&amp; !fn) {
    if (this._events[ev]) this._events[ev]._ = null;
    return this;
  } else {
    function isEmpty (obj) {
      for (var name in obj)
        if (obj[name] &amp;&amp; name != '_') return false;
      return true;
    };

    function clean (event) {
      if (fn &amp;&amp; 'function' === typeof fn) {
        for (var i = 0; i &lt; event._.length; i++)
          if (fn == event._[i]) event._.splice(i, 1);
        if (event._.length === 0) event._ = null;
        if (event._ &amp;&amp; event._.length == 1) event._ = event._[0];
      } else {
        event._ = null;
      }

      if (!event._ &amp;&amp; isEmpty(event)) event = null;
      return event;
    };

    function iterate (events, map) {
      var event = events.shift();
      if (map[event] &amp;&amp; map[event]._ &amp;&amp; !events.length) map[event] = clean(map[event]);
      if (map[event] &amp;&amp; events.length) map[event] = iterate(events, map[event]);
      if (!map[event] &amp;&amp; isEmpty(map)) map = null;
      return map;
    };

    this._events = iterate(evs, this._events);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super._super.prototype.removeListener" id="apidoc.element.apnagent.Agent._super._super.prototype.removeListener">
        function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>removeListener
        <span class="apidocSignatureSpan">(ev, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">removeListener = function (ev, fn) {
  if (!this._events || arguments.length === 0) {
    this._events = {};
    return this;
  }

  var evs = Array.isArray(ev)
      ? ev.slice(0)
      : ev.split(this._drip.delimeter);

  if (evs.length === 1 &amp;&amp; !fn) {
    if (this._events[ev]) this._events[ev]._ = null;
    return this;
  } else {
    function isEmpty (obj) {
      for (var name in obj)
        if (obj[name] &amp;&amp; name != '_') return false;
      return true;
    };

    function clean (event) {
      if (fn &amp;&amp; 'function' === typeof fn) {
        for (var i = 0; i &lt; event._.length; i++)
          if (fn == event._[i]) event._.splice(i, 1);
        if (event._.length === 0) event._ = null;
        if (event._ &amp;&amp; event._.length == 1) event._ = event._[0];
      } else {
        event._ = null;
      }

      if (!event._ &amp;&amp; isEmpty(event)) event = null;
      return event;
    };

    function iterate (events, map) {
      var event = events.shift();
      if (map[event] &amp;&amp; map[event]._ &amp;&amp; !events.length) map[event] = clean(map[event]);
      if (map[event] &amp;&amp; events.length) map[event] = iterate(events, map[event]);
      if (!map[event] &amp;&amp; isEmpty(map)) map = null;
      return map;
    };

    this._events = iterate(evs, this._events);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super._super.prototype.unbindEvent" id="apidoc.element.apnagent.Agent._super._super.prototype.unbindEvent">
        function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>unbindEvent
        <span class="apidocSignatureSpan">(ev, target)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unbindEvent = function (ev, target) {
  var proxy = eventProxy.call(this, ev, target);
  this.off(ev, proxy);
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super._super.prototype.unproxyEvent" id="apidoc.element.apnagent.Agent._super._super.prototype.unproxyEvent">
        function <span class="apidocSignatureSpan">apnagent.Agent._super._super.prototype.</span>unproxyEvent
        <span class="apidocSignatureSpan">(ev, ns, target)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unproxyEvent = function (ev, ns, target) {
  if (arguments.length === 2) target = ns, ns = null;
  var drip = this._drip || {}
    , listen = !drip.delimeter
      ? (ns  ? ns + ':' + ev : ev)
      : (ns
        ? (Array.isArray(ns)
          ? concat(ns, [ ev ])
          : concat(ns.split(drip.delimeter), [ ev ]))
        : ev);

  target.removeListener(ev, eventProxy.call(this, listen, this));
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Agent._super.prototype" id="apidoc.module.apnagent.Agent._super.prototype">module apnagent.Agent._super.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype._queueIterator" id="apidoc.element.apnagent.Agent._super.prototype._queueIterator">
        function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>_queueIterator
        <span class="apidocSignatureSpan">(buf, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_queueIterator = function (buf, next) {
  throw new Error('Queue iterator not implemented.');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.close" id="apidoc.element.apnagent.Agent._super.prototype.close">
        function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>close
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">close = function () {
  throw new Error('Gateway close not implemented');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.connect" id="apidoc.element.apnagent.Agent._super.prototype.connect">
        function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>connect
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">connect = function () {
  throw new Error('Gateway connect not implemented.');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.createMessage" id="apidoc.element.apnagent.Agent._super.prototype.createMessage">
        function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>createMessage
        <span class="apidocSignatureSpan">(enc)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">createMessage = function (enc) {
  var codec = this.get('codec');
  return new Message(this, codec, { enc: enc });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.disable" id="apidoc.element.apnagent.Agent._super.prototype.disable">
        function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>disable
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">disable = function (key) {
  return this.set(key, false);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.disabled" id="apidoc.element.apnagent.Agent._super.prototype.disabled">
        function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>disabled
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">disabled = function (key) {
  return !!! this.get(key);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.enable" id="apidoc.element.apnagent.Agent._super.prototype.enable">
        function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>enable
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">enable = function (key) {
  return this.set(key, true);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.enabled" id="apidoc.element.apnagent.Agent._super.prototype.enabled">
        function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>enabled
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">enabled = function (key) {
  return !! this.get(key);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.get" id="apidoc.element.apnagent.Agent._super.prototype.get">
        function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>get
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (key) {
  return this.set(key);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.nextId" id="apidoc.element.apnagent.Agent._super.prototype.nextId">
        function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>nextId
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">nextId = function () {
  var i = ++this.meta.lastId;

  if (i &gt; INT32) {
    i = this.meta.lastId = 0;
  }

  return i;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.send" id="apidoc.element.apnagent.Agent._super.prototype.send">
        function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>send
        <span class="apidocSignatureSpan">(msg, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">send = function (msg, cb) {
  cb = cb || function () {};

  var self = this
    , codecStr = msg.meta.codec
    , codec = codecs.getId('gateway ' + codecStr)
    , json;

  // handle error
  function error (err) {
    process.nextTick(function () {
      debug('(message) error: %s', err.message);
      cb(err);
      self.emit('message:error', err, msg);
    });
  }

  // check for codec
  if (!~[ 0, 1 ].indexOf(codec)) {
    error(new errors.SerializationError('Invalid codec: ' + codecStr));
    return this;
  }

  // serialize the message
  try {
    json = msg.serialize();
  } catch (ex) {
    error(ex);
    return this;
  }

  // write json to to the queue
  debug('(queue) push: %d', json.identifier);
  this.queue.push({ codec: codec, json: json }, cb, true);
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.set" id="apidoc.element.apnagent.Agent._super.prototype.set">
        function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>set
        <span class="apidocSignatureSpan">(key, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">set = function (key, value) {
  var settings = this[prop] || (this[prop] = {});

  if (1 === arguments.length) {
    if ('string' === typeof key) {
      return settings[key];
    } else {
      for (var name in key) {
        this.set(name, key[name]);
      }
    }
  } else {
    settings[key] = value;
    handle.call(this, key, value);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Agent._super.prototype._queueIterator" id="apidoc.module.apnagent.Agent._super.prototype._queueIterator">module apnagent.Agent._super.prototype._queueIterator</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype._queueIterator._queueIterator" id="apidoc.element.apnagent.Agent._super.prototype._queueIterator._queueIterator">
        function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>_queueIterator
        <span class="apidocSignatureSpan">(buf, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_queueIterator = function (buf, next) {
  throw new Error('Queue iterator not implemented.');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Agent._super.prototype.close" id="apidoc.module.apnagent.Agent._super.prototype.close">module apnagent.Agent._super.prototype.close</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.close.close" id="apidoc.element.apnagent.Agent._super.prototype.close.close">
        function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>close
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">close = function () {
  throw new Error('Gateway close not implemented');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Agent._super.prototype.connect" id="apidoc.module.apnagent.Agent._super.prototype.connect">module apnagent.Agent._super.prototype.connect</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.connect.connect" id="apidoc.element.apnagent.Agent._super.prototype.connect.connect">
        function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>connect
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">connect = function () {
  throw new Error('Gateway connect not implemented.');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Agent._super.prototype.createMessage" id="apidoc.module.apnagent.Agent._super.prototype.createMessage">module apnagent.Agent._super.prototype.createMessage</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.createMessage.createMessage" id="apidoc.element.apnagent.Agent._super.prototype.createMessage.createMessage">
        function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>createMessage
        <span class="apidocSignatureSpan">(enc)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">createMessage = function (enc) {
  var codec = this.get('codec');
  return new Message(this, codec, { enc: enc });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Agent._super.prototype.disable" id="apidoc.module.apnagent.Agent._super.prototype.disable">module apnagent.Agent._super.prototype.disable</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.disable.disable" id="apidoc.element.apnagent.Agent._super.prototype.disable.disable">
        function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>disable
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">disable = function (key) {
  return this.set(key, false);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Agent._super.prototype.disabled" id="apidoc.module.apnagent.Agent._super.prototype.disabled">module apnagent.Agent._super.prototype.disabled</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.disabled.disabled" id="apidoc.element.apnagent.Agent._super.prototype.disabled.disabled">
        function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>disabled
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">disabled = function (key) {
  return !!! this.get(key);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Agent._super.prototype.enable" id="apidoc.module.apnagent.Agent._super.prototype.enable">module apnagent.Agent._super.prototype.enable</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.enable.enable" id="apidoc.element.apnagent.Agent._super.prototype.enable.enable">
        function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>enable
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">enable = function (key) {
  return this.set(key, true);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Agent._super.prototype.enabled" id="apidoc.module.apnagent.Agent._super.prototype.enabled">module apnagent.Agent._super.prototype.enabled</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.enabled.enabled" id="apidoc.element.apnagent.Agent._super.prototype.enabled.enabled">
        function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>enabled
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">enabled = function (key) {
  return !! this.get(key);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Agent._super.prototype.get" id="apidoc.module.apnagent.Agent._super.prototype.get">module apnagent.Agent._super.prototype.get</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.get.get" id="apidoc.element.apnagent.Agent._super.prototype.get.get">
        function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>get
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (key) {
  return this.set(key);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Agent._super.prototype.nextId" id="apidoc.module.apnagent.Agent._super.prototype.nextId">module apnagent.Agent._super.prototype.nextId</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.nextId.nextId" id="apidoc.element.apnagent.Agent._super.prototype.nextId.nextId">
        function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>nextId
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">nextId = function () {
  var i = ++this.meta.lastId;

  if (i &gt; INT32) {
    i = this.meta.lastId = 0;
  }

  return i;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Agent._super.prototype.send" id="apidoc.module.apnagent.Agent._super.prototype.send">module apnagent.Agent._super.prototype.send</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.send.send" id="apidoc.element.apnagent.Agent._super.prototype.send.send">
        function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>send
        <span class="apidocSignatureSpan">(msg, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">send = function (msg, cb) {
  cb = cb || function () {};

  var self = this
    , codecStr = msg.meta.codec
    , codec = codecs.getId('gateway ' + codecStr)
    , json;

  // handle error
  function error (err) {
    process.nextTick(function () {
      debug('(message) error: %s', err.message);
      cb(err);
      self.emit('message:error', err, msg);
    });
  }

  // check for codec
  if (!~[ 0, 1 ].indexOf(codec)) {
    error(new errors.SerializationError('Invalid codec: ' + codecStr));
    return this;
  }

  // serialize the message
  try {
    json = msg.serialize();
  } catch (ex) {
    error(ex);
    return this;
  }

  // write json to to the queue
  debug('(queue) push: %d', json.identifier);
  this.queue.push({ codec: codec, json: json }, cb, true);
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Agent._super.prototype.set" id="apidoc.module.apnagent.Agent._super.prototype.set">module apnagent.Agent._super.prototype.set</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Agent._super.prototype.set.set" id="apidoc.element.apnagent.Agent._super.prototype.set.set">
        function <span class="apidocSignatureSpan">apnagent.Agent._super.prototype.</span>set
        <span class="apidocSignatureSpan">(key, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">set = function (key, value) {
  var settings = this[prop] || (this[prop] = {});

  if (1 === arguments.length) {
    if ('string' === typeof key) {
      return settings[key];
    } else {
      for (var name in key) {
        this.set(name, key[name]);
      }
    }
  } else {
    settings[key] = value;
    handle.call(this, key, value);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Agent.prototype" id="apidoc.module.apnagent.Agent.prototype">module apnagent.Agent.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Agent.prototype._queueIterator" id="apidoc.element.apnagent.Agent.prototype._queueIterator">
        function <span class="apidocSignatureSpan">apnagent.Agent.prototype.</span>_queueIterator
        <span class="apidocSignatureSpan">(obj, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_queueIterator = function (obj, next) {
  var self = this
    , cache = this.cache
    , encoder = this.encoder
    , stream = encoder.stream(obj.codec)
    , id = obj.json.identifier
    , queue = this.queue;

  // wait for encoded message
  encoder.once('readable', function () {
    var buf = encoder.read()
      , gateway = self.gateway;

    // requeue if not connected
    if (!gateway || !gateway.writable || !self.connected) {
      debug('(queue) pause: not connected');
      queue.pause();
      queue.pushAt(0, obj);
      return next();
    }

    debug('(gateway) write: %d', id);
    gateway.write(buf, function () {
      debug('(cache) push: %d', id);
      cache.push(id, obj);
      next();
    });
  });

  // encode message
  debug('(encoder) write: %d', id);
  stream.write(obj.json);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent.prototype._reconnect" id="apidoc.element.apnagent.Agent.prototype._reconnect">
        function <span class="apidocSignatureSpan">apnagent.Agent.prototype.</span>_reconnect
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_reconnect = function (){
  var self = this
    , gwe = self.meta.gatewayError
    , pos = 0;

  if (gwe &amp;&amp; 'undefined' !== typeof gwe.identifier) {
    debug('(cache) since: %d', gwe.identifier);
    self.cache.sinceId(gwe.identifier, function (obj, id) {
      debug('(queue) push: %d', id);
      self.queue.pushAt(pos++, obj);
    });
  }

  debug('(gateway) reconnecting');
  self.connect(function (err) {
    if (err) return;
    debug('(gateway) reconnected');
    self.emit('gateway:reconnect');
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent.prototype.close" id="apidoc.element.apnagent.Agent.prototype.close">
        function <span class="apidocSignatureSpan">apnagent.Agent.prototype.</span>close
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">close = function (cb) {
  cb = cb || function () {};

  // leave if nothing needs to be done
  if (!this.connected || !this.gateway) {
    clearTimeout(this.meta.timer);
    process.nextTick(cb);
    return this;
  }

  var self = this
    , drain = this.queue.drain;

  // wait for queue to finish processing current
  this.queue.drain = function () {
    debug('(gateway) disconnecting');
    self.cache.pause();
    self.gateway.once('close', cb);
    self.gateway.destroy();
    self.queue.drain = drain;
  };

  // set things in motion
  this.connected = false;
  this.queue.pause();
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Agent.prototype.connect" id="apidoc.element.apnagent.Agent.prototype.connect">
        function <span class="apidocSignatureSpan">apnagent.Agent.prototype.</span>connect
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">connect = function (cb) {
  cb = cb || function () {};

  var self = this
    , delay = this.get('reconnect delay')
    , opts = util.gatewayOptions(this)
    , recon = this.enabled('reconnect')
    , ttl = this.get('cache ttl')
    , gateway;

  // don't try to connect without credentials
  if (!opts.pfx &amp;&amp; !opts.key &amp;&amp; !opts.cert) {
    process.nextTick(function () {
      var err = new errors.GatewayAuthorizationError('Insufficient credentials');
      debug('(gateway) error: %s', err.message);
      self.emit('gateway:error', err);
      cb(err);
    });

    return this;
  }

  // reset state
  this.meta.gatewayError = null;

  // connect to gateway
  debug('(gateway) connecting - %s:%d', opts.host, opts.port);
  gateway = tls.connect(opts, function () {
    if (gateway.authorized) {
      debug('(gateway) connected - %s:%d', opts.host, opts.port);
      self.connected = true;
      self.cache.ttl = ttl;
      self.cache.resume();
      self.queue.resume();
      self.emit('gateway:connect');
      cb();
    } else {
      var err = new errors.GatewayAuthorizationError(gateway.authorizationError);
      debug('(gateway) unauthorized - %s:%d', opts.host, opts.port, gateway.authorizationError);
      self.gateway.destroy();
      self.emit('gateway:error', err);
      cb(err);
    }
  });

  // handle a disconnection
  gateway.on('close', function () {
    self.cache.pause();
    self.queue.pause();
    self.gateway = null;

    if (self.connected &amp;&amp; recon) {
      debug('(gateway) disconnected - %s:%d', opts.host, opts.port);
      self.connected = false;
      self.meta.timer = setTimeout(self._reconnect.bind(self), ms(delay));
    } else {
      debug('(gateway) closed - %s:%d', opts.host, opts.port);
      self.connected = false;
      self.emit('gateway:close');
    }
  });

  // handle incoming data
  gateway.on('data', function (buf) {
    debug('(gateway) data: %d bytes', buf.length);
    self.decoder.write(buf);
  });

  // emit errors;
  gateway.on('error', function (err) {
    debug('(gateway) error: %s', err.message || 'Unspecified Error');
    if (self.gateway) self.gateway.destroy();
    self.emit('gateway:error', err);
  });

  // mount
  this.gateway = gateway;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Agent.prototype._queueIterator" id="apidoc.module.apnagent.Agent.prototype._queueIterator">module apnagent.Agent.prototype._queueIterator</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Agent.prototype._queueIterator._queueIterator" id="apidoc.element.apnagent.Agent.prototype._queueIterator._queueIterator">
        function <span class="apidocSignatureSpan">apnagent.Agent.prototype.</span>_queueIterator
        <span class="apidocSignatureSpan">(obj, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_queueIterator = function (obj, next) {
  var self = this
    , cache = this.cache
    , encoder = this.encoder
    , stream = encoder.stream(obj.codec)
    , id = obj.json.identifier
    , queue = this.queue;

  // wait for encoded message
  encoder.once('readable', function () {
    var buf = encoder.read()
      , gateway = self.gateway;

    // requeue if not connected
    if (!gateway || !gateway.writable || !self.connected) {
      debug('(queue) pause: not connected');
      queue.pause();
      queue.pushAt(0, obj);
      return next();
    }

    debug('(gateway) write: %d', id);
    gateway.write(buf, function () {
      debug('(cache) push: %d', id);
      cache.push(id, obj);
      next();
    });
  });

  // encode message
  debug('(encoder) write: %d', id);
  stream.write(obj.json);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Agent.prototype._reconnect" id="apidoc.module.apnagent.Agent.prototype._reconnect">module apnagent.Agent.prototype._reconnect</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Agent.prototype._reconnect._reconnect" id="apidoc.element.apnagent.Agent.prototype._reconnect._reconnect">
        function <span class="apidocSignatureSpan">apnagent.Agent.prototype.</span>_reconnect
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_reconnect = function (){
  var self = this
    , gwe = self.meta.gatewayError
    , pos = 0;

  if (gwe &amp;&amp; 'undefined' !== typeof gwe.identifier) {
    debug('(cache) since: %d', gwe.identifier);
    self.cache.sinceId(gwe.identifier, function (obj, id) {
      debug('(queue) push: %d', id);
      self.queue.pushAt(pos++, obj);
    });
  }

  debug('(gateway) reconnecting');
  self.connect(function (err) {
    if (err) return;
    debug('(gateway) reconnected');
    self.emit('gateway:reconnect');
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Agent.prototype.close" id="apidoc.module.apnagent.Agent.prototype.close">module apnagent.Agent.prototype.close</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Agent.prototype.close.close" id="apidoc.element.apnagent.Agent.prototype.close.close">
        function <span class="apidocSignatureSpan">apnagent.Agent.prototype.</span>close
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">close = function (cb) {
  cb = cb || function () {};

  // leave if nothing needs to be done
  if (!this.connected || !this.gateway) {
    clearTimeout(this.meta.timer);
    process.nextTick(cb);
    return this;
  }

  var self = this
    , drain = this.queue.drain;

  // wait for queue to finish processing current
  this.queue.drain = function () {
    debug('(gateway) disconnecting');
    self.cache.pause();
    self.gateway.once('close', cb);
    self.gateway.destroy();
    self.queue.drain = drain;
  };

  // set things in motion
  this.connected = false;
  this.queue.pause();
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Agent.prototype.connect" id="apidoc.module.apnagent.Agent.prototype.connect">module apnagent.Agent.prototype.connect</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Agent.prototype.connect.connect" id="apidoc.element.apnagent.Agent.prototype.connect.connect">
        function <span class="apidocSignatureSpan">apnagent.Agent.prototype.</span>connect
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">connect = function (cb) {
  cb = cb || function () {};

  var self = this
    , delay = this.get('reconnect delay')
    , opts = util.gatewayOptions(this)
    , recon = this.enabled('reconnect')
    , ttl = this.get('cache ttl')
    , gateway;

  // don't try to connect without credentials
  if (!opts.pfx &amp;&amp; !opts.key &amp;&amp; !opts.cert) {
    process.nextTick(function () {
      var err = new errors.GatewayAuthorizationError('Insufficient credentials');
      debug('(gateway) error: %s', err.message);
      self.emit('gateway:error', err);
      cb(err);
    });

    return this;
  }

  // reset state
  this.meta.gatewayError = null;

  // connect to gateway
  debug('(gateway) connecting - %s:%d', opts.host, opts.port);
  gateway = tls.connect(opts, function () {
    if (gateway.authorized) {
      debug('(gateway) connected - %s:%d', opts.host, opts.port);
      self.connected = true;
      self.cache.ttl = ttl;
      self.cache.resume();
      self.queue.resume();
      self.emit('gateway:connect');
      cb();
    } else {
      var err = new errors.GatewayAuthorizationError(gateway.authorizationError);
      debug('(gateway) unauthorized - %s:%d', opts.host, opts.port, gateway.authorizationError);
      self.gateway.destroy();
      self.emit('gateway:error', err);
      cb(err);
    }
  });

  // handle a disconnection
  gateway.on('close', function () {
    self.cache.pause();
    self.queue.pause();
    self.gateway = null;

    if (self.connected &amp;&amp; recon) {
      debug('(gateway) disconnected - %s:%d', opts.host, opts.port);
      self.connected = false;
      self.meta.timer = setTimeout(self._reconnect.bind(self), ms(delay));
    } else {
      debug('(gateway) closed - %s:%d', opts.host, opts.port);
      self.connected = false;
      self.emit('gateway:close');
    }
  });

  // handle incoming data
  gateway.on('data', function (buf) {
    debug('(gateway) data: %d bytes', buf.length);
    self.decoder.write(buf);
  });

  // emit errors;
  gateway.on('error', function (err) {
    debug('(gateway) error: %s', err.message || 'Unspecified Error');
    if (self.gateway) self.gateway.destroy();
    self.emit('gateway:error', err);
  });

  // mount
  this.gateway = gateway;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Device" id="apidoc.module.apnagent.Device">module apnagent.Device</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Device.Device" id="apidoc.element.apnagent.Device.Device">
        function <span class="apidocSignatureSpan">apnagent.</span>Device
        <span class="apidocSignatureSpan">(token)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Device(token) {
<span class="apidocCodeCommentSpan">  /*!
   * @param {String|Buffer|Device} device token
   * @api public
   */
</span>  if (token instanceof Device) {
    token = token.toString();
  }

  this.token = token || undefined;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Device.prototype" id="apidoc.module.apnagent.Device.prototype">module apnagent.Device.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Device.prototype.equal" id="apidoc.element.apnagent.Device.prototype.equal">
        function <span class="apidocSignatureSpan">apnagent.Device.prototype.</span>equal
        <span class="apidocSignatureSpan">(dev)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">equal = function (dev) {
  var token1 = this.toString()
    , token2 = dev instanceof Device
      ? dev.toString()
      : stringify(dev);

  return token1
    &amp;&amp; token2
    &amp;&amp; token1 === token2;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Device.prototype.toBuffer" id="apidoc.element.apnagent.Device.prototype.toBuffer">
        function <span class="apidocSignatureSpan">apnagent.Device.prototype.</span>toBuffer
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toBuffer = function () {
  return bufferize(this.token);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Device.prototype.toString" id="apidoc.element.apnagent.Device.prototype.toString">
        function <span class="apidocSignatureSpan">apnagent.Device.prototype.</span>toString
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toString = function () {
  return stringify(this.token);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Device.prototype.equal" id="apidoc.module.apnagent.Device.prototype.equal">module apnagent.Device.prototype.equal</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Device.prototype.equal.equal" id="apidoc.element.apnagent.Device.prototype.equal.equal">
        function <span class="apidocSignatureSpan">apnagent.Device.prototype.</span>equal
        <span class="apidocSignatureSpan">(dev)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">equal = function (dev) {
  var token1 = this.toString()
    , token2 = dev instanceof Device
      ? dev.toString()
      : stringify(dev);

  return token1
    &amp;&amp; token2
    &amp;&amp; token1 === token2;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Device.prototype.toBuffer" id="apidoc.module.apnagent.Device.prototype.toBuffer">module apnagent.Device.prototype.toBuffer</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Device.prototype.toBuffer.toBuffer" id="apidoc.element.apnagent.Device.prototype.toBuffer.toBuffer">
        function <span class="apidocSignatureSpan">apnagent.Device.prototype.</span>toBuffer
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toBuffer = function () {
  return bufferize(this.token);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Device.prototype.toString" id="apidoc.module.apnagent.Device.prototype.toString">module apnagent.Device.prototype.toString</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Device.prototype.toString.toString" id="apidoc.element.apnagent.Device.prototype.toString.toString">
        function <span class="apidocSignatureSpan">apnagent.Device.prototype.</span>toString
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function toString() { [native code] }</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Feedback" id="apidoc.module.apnagent.Feedback">module apnagent.Feedback</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Feedback.Feedback" id="apidoc.element.apnagent.Feedback.Feedback">
        function <span class="apidocSignatureSpan">apnagent.</span>Feedback
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Feedback() {
  Base.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super" id="apidoc.element.apnagent.Feedback._super">
        function <span class="apidocSignatureSpan">apnagent.Feedback.</span>_super
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Base() {
  EventEmitter.call(this, { delimeter: ':' });
  this.connected = false;
  this.set('interval', '30m');
  this.disable('sandbox');

  this.meta = {};
  this.meta.timer = null;
  this.meta.stack = [ emit ];

  var self = this
    , decoder, queue;

  // queue handles user interaction with responses
  queue = new Queue(function (obj, done) {
    var device = obj.device
      , stack = self.meta.stack
      , timestamp = obj.timestamp;

    // intercept errors so as not to cancel queue
    function finish (err) {
      if (err) {
        debug('(iterate) error - %s', err.message);
        self.emit('iterate:error', err, device, timestamp);
      }

      debug('(iterate) end - %s', device.toString());
      done();
    }

    // start iteration
    debug('(iterate) start - %s', device.toString());
    series(stack, function (fn, next) {
      fn.apply(self, [ device, timestamp, next ]);
    }, finish);
  }, 10);

  // emit queue errors on feedback agent
  queue.onerror = function (err) {
    debug('(queue) error: %s', err.message);
    self.emit('queue:error', err);
  };

  // emit queue drain on feedback agent
  queue.drain = function () {
    debug('(queue) drain');
    self.emit('queue:drain');
  };

  // decoder handing incoming feedback responses
  decoder = lotus.createDecoder();
  decoder.stream(codecs.getInterface('feedback response', 'decode'));
  decoder.stream().on('readable', function () {
    var obj = this.read()
      , res = {};
    res.device = new Device(obj.deviceToken);
    res.timestamp = new Date(obj.timestamp * 1000);
    queue.push(res, true);
  });

  this.decoder = decoder;
  this.feedback = null;
  this.queue = queue;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Feedback._super" id="apidoc.module.apnagent.Feedback._super">module apnagent.Feedback._super</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super._super" id="apidoc.element.apnagent.Feedback._super._super">
        function <span class="apidocSignatureSpan">apnagent.Feedback.</span>_super
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EnhancedEmitter(opts) {
  opts = opts || {};
  this._drip = {};
  this._drip.delimeter = opts.delimeter || ':';
  this._drip.wildcard = opts.wildcard || (opts.delimeter ? true : false);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Feedback._super.prototype" id="apidoc.module.apnagent.Feedback._super.prototype">module apnagent.Feedback._super.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.close" id="apidoc.element.apnagent.Feedback._super.prototype.close">
        function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>close
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">close = function () {
  throw new Error('Feedback close not implemented.');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.connect" id="apidoc.element.apnagent.Feedback._super.prototype.connect">
        function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>connect
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">connect = function () {
  throw new Error('Feedback connect not implemented.');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.disable" id="apidoc.element.apnagent.Feedback._super.prototype.disable">
        function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>disable
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">disable = function (key) {
  return this.set(key, false);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.disabled" id="apidoc.element.apnagent.Feedback._super.prototype.disabled">
        function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>disabled
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">disabled = function (key) {
  return !!! this.get(key);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.enable" id="apidoc.element.apnagent.Feedback._super.prototype.enable">
        function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>enable
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">enable = function (key) {
  return this.set(key, true);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.enabled" id="apidoc.element.apnagent.Feedback._super.prototype.enabled">
        function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>enabled
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">enabled = function (key) {
  return !! this.get(key);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.get" id="apidoc.element.apnagent.Feedback._super.prototype.get">
        function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>get
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (key) {
  return this.set(key);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.set" id="apidoc.element.apnagent.Feedback._super.prototype.set">
        function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>set
        <span class="apidocSignatureSpan">(key, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">set = function (key, value) {
  var settings = this[prop] || (this[prop] = {});

  if (1 === arguments.length) {
    if ('string' === typeof key) {
      return settings[key];
    } else {
      for (var name in key) {
        this.set(name, key[name]);
      }
    }
  } else {
    settings[key] = value;
    handle.call(this, key, value);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.unsub" id="apidoc.element.apnagent.Feedback._super.prototype.unsub">
        function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>unsub
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unsub = function () {}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.use" id="apidoc.element.apnagent.Feedback._super.prototype.use">
        function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>use
        <span class="apidocSignatureSpan">(fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">use = function (fn) {
  this.meta.stack.push(fn);
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Feedback._super.prototype.close" id="apidoc.module.apnagent.Feedback._super.prototype.close">module apnagent.Feedback._super.prototype.close</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.close.close" id="apidoc.element.apnagent.Feedback._super.prototype.close.close">
        function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>close
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">close = function () {
  throw new Error('Feedback close not implemented.');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Feedback._super.prototype.connect" id="apidoc.module.apnagent.Feedback._super.prototype.connect">module apnagent.Feedback._super.prototype.connect</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.connect.connect" id="apidoc.element.apnagent.Feedback._super.prototype.connect.connect">
        function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>connect
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">connect = function () {
  throw new Error('Feedback connect not implemented.');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Feedback._super.prototype.disable" id="apidoc.module.apnagent.Feedback._super.prototype.disable">module apnagent.Feedback._super.prototype.disable</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.disable.disable" id="apidoc.element.apnagent.Feedback._super.prototype.disable.disable">
        function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>disable
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">disable = function (key) {
  return this.set(key, false);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Feedback._super.prototype.disabled" id="apidoc.module.apnagent.Feedback._super.prototype.disabled">module apnagent.Feedback._super.prototype.disabled</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.disabled.disabled" id="apidoc.element.apnagent.Feedback._super.prototype.disabled.disabled">
        function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>disabled
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">disabled = function (key) {
  return !!! this.get(key);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Feedback._super.prototype.enable" id="apidoc.module.apnagent.Feedback._super.prototype.enable">module apnagent.Feedback._super.prototype.enable</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.enable.enable" id="apidoc.element.apnagent.Feedback._super.prototype.enable.enable">
        function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>enable
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">enable = function (key) {
  return this.set(key, true);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Feedback._super.prototype.enabled" id="apidoc.module.apnagent.Feedback._super.prototype.enabled">module apnagent.Feedback._super.prototype.enabled</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.enabled.enabled" id="apidoc.element.apnagent.Feedback._super.prototype.enabled.enabled">
        function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>enabled
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">enabled = function (key) {
  return !! this.get(key);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Feedback._super.prototype.get" id="apidoc.module.apnagent.Feedback._super.prototype.get">module apnagent.Feedback._super.prototype.get</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.get.get" id="apidoc.element.apnagent.Feedback._super.prototype.get.get">
        function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>get
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (key) {
  return this.set(key);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Feedback._super.prototype.set" id="apidoc.module.apnagent.Feedback._super.prototype.set">module apnagent.Feedback._super.prototype.set</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.set.set" id="apidoc.element.apnagent.Feedback._super.prototype.set.set">
        function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>set
        <span class="apidocSignatureSpan">(key, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">set = function (key, value) {
  var settings = this[prop] || (this[prop] = {});

  if (1 === arguments.length) {
    if ('string' === typeof key) {
      return settings[key];
    } else {
      for (var name in key) {
        this.set(name, key[name]);
      }
    }
  } else {
    settings[key] = value;
    handle.call(this, key, value);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Feedback._super.prototype.unsub" id="apidoc.module.apnagent.Feedback._super.prototype.unsub">module apnagent.Feedback._super.prototype.unsub</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.unsub.unsub" id="apidoc.element.apnagent.Feedback._super.prototype.unsub.unsub">
        function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>unsub
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unsub = function () {}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Feedback._super.prototype.use" id="apidoc.module.apnagent.Feedback._super.prototype.use">module apnagent.Feedback._super.prototype.use</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Feedback._super.prototype.use.use" id="apidoc.element.apnagent.Feedback._super.prototype.use.use">
        function <span class="apidocSignatureSpan">apnagent.Feedback._super.prototype.</span>use
        <span class="apidocSignatureSpan">(fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">use = function (fn) {
  this.meta.stack.push(fn);
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Feedback.prototype" id="apidoc.module.apnagent.Feedback.prototype">module apnagent.Feedback.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Feedback.prototype.close" id="apidoc.element.apnagent.Feedback.prototype.close">
        function <span class="apidocSignatureSpan">apnagent.Feedback.prototype.</span>close
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">close = function (cb) {
  cb = cb || function () {};

  // if not connected, cancel reconnect time
  if (!this.connected || !this.feedback) {
    clearTimeout(this.meta.timer);
    process.nextTick(cb);
    return this;
  }

  // wait for feedback to finish download
  this.feedback.once('end', cb);
  this.connected = false;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.Feedback.prototype.connect" id="apidoc.element.apnagent.Feedback.prototype.connect">
        function <span class="apidocSignatureSpan">apnagent.Feedback.prototype.</span>connect
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">connect = function (cb) {
  cb = cb || function () {};

  var self = this
    , interval = this.get('interval')
    , opts = util.feedbackOptions(this)
    , feedback;

  // don't try to connect without credentials
  if (!opts.pfx &amp;&amp; !opts.key &amp;&amp; !opts.cert) {
    process.nextTick(function () {
      var err = new errors.FeedbackAuthorizationError('Insufficient credentials');
      debug('(feedback) error: %s', err.message);
      self.emit('feedback:error', err);
      cb(err);
    });

    return this;
  }

  // how to perform a reconnect
  function reconnect () {
    debug('(feedback) reconnecting');
    self.connect(function (err) {
      if (err) return;
      debug('(feedback) reconnected');
      self.emit('feedback:reconnect');
    });
  }

  // connect to feedback service
  feedback = tls.connect(opts, function () {
    if (feedback.authorized) {
      debug('(feedback) connected - %s:%d', opts.host, opts.port);
      self.connected = true;
      self.emit('feedback:connect');
      cb();
    } else {
      var err = new error.FeedbackAuthorizationError(gateway.authorizationError);
      debug('(feedback) unauthorized - %s:%d', opts.host, opts.port, gateway.authorizationError);
      self.feedback.destroy();
      self.emit('gateway:error', err);
      cb(err);
    }
  });

  // handle a disconnection (expected)
  feedback.on('close', function () {
    self.feedback = null;

    if (self.connected) {
      debug('(feedback) disconnected - %s:%d', opts.host, opts.port);
      self.connected = false;
      self.meta.timer = setTimeout(reconnect, ms(interval));
    } else {
      debug('(feedback) closed - %s:%d', opts.host, opts.port);
      self.connected = false;
      self.emit('feedback:close');
    }
  });

  // handle incoming data
  feedback.on('data', function (buf) {
    debug('(feedback) data: %d bytes', buf.length);
    self.decoder.write(buf);
  });

  // emit errors;
  feedback.on('error', function (err) {
    debug('(feedback) error: %s', err.message || 'Unspecified Error');
    self.emit('feedback:error', err);
  });

  // mount
  this.feedback = feedback;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Feedback.prototype.close" id="apidoc.module.apnagent.Feedback.prototype.close">module apnagent.Feedback.prototype.close</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Feedback.prototype.close.close" id="apidoc.element.apnagent.Feedback.prototype.close.close">
        function <span class="apidocSignatureSpan">apnagent.Feedback.prototype.</span>close
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">close = function (cb) {
  cb = cb || function () {};

  // if not connected, cancel reconnect time
  if (!this.connected || !this.feedback) {
    clearTimeout(this.meta.timer);
    process.nextTick(cb);
    return this;
  }

  // wait for feedback to finish download
  this.feedback.once('end', cb);
  this.connected = false;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.Feedback.prototype.connect" id="apidoc.module.apnagent.Feedback.prototype.connect">module apnagent.Feedback.prototype.connect</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.Feedback.prototype.connect.connect" id="apidoc.element.apnagent.Feedback.prototype.connect.connect">
        function <span class="apidocSignatureSpan">apnagent.Feedback.prototype.</span>connect
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">connect = function (cb) {
  cb = cb || function () {};

  var self = this
    , interval = this.get('interval')
    , opts = util.feedbackOptions(this)
    , feedback;

  // don't try to connect without credentials
  if (!opts.pfx &amp;&amp; !opts.key &amp;&amp; !opts.cert) {
    process.nextTick(function () {
      var err = new errors.FeedbackAuthorizationError('Insufficient credentials');
      debug('(feedback) error: %s', err.message);
      self.emit('feedback:error', err);
      cb(err);
    });

    return this;
  }

  // how to perform a reconnect
  function reconnect () {
    debug('(feedback) reconnecting');
    self.connect(function (err) {
      if (err) return;
      debug('(feedback) reconnected');
      self.emit('feedback:reconnect');
    });
  }

  // connect to feedback service
  feedback = tls.connect(opts, function () {
    if (feedback.authorized) {
      debug('(feedback) connected - %s:%d', opts.host, opts.port);
      self.connected = true;
      self.emit('feedback:connect');
      cb();
    } else {
      var err = new error.FeedbackAuthorizationError(gateway.authorizationError);
      debug('(feedback) unauthorized - %s:%d', opts.host, opts.port, gateway.authorizationError);
      self.feedback.destroy();
      self.emit('gateway:error', err);
      cb(err);
    }
  });

  // handle a disconnection (expected)
  feedback.on('close', function () {
    self.feedback = null;

    if (self.connected) {
      debug('(feedback) disconnected - %s:%d', opts.host, opts.port);
      self.connected = false;
      self.meta.timer = setTimeout(reconnect, ms(interval));
    } else {
      debug('(feedback) closed - %s:%d', opts.host, opts.port);
      self.connected = false;
      self.emit('feedback:close');
    }
  });

  // handle incoming data
  feedback.on('data', function (buf) {
    debug('(feedback) data: %d bytes', buf.length);
    self.decoder.write(buf);
  });

  // emit errors;
  feedback.on('error', function (err) {
    debug('(feedback) error: %s', err.message || 'Unspecified Error');
    self.emit('feedback:error', err);
  });

  // mount
  this.feedback = feedback;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.MockAgent" id="apidoc.module.apnagent.MockAgent">module apnagent.MockAgent</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.MockAgent.MockAgent" id="apidoc.element.apnagent.MockAgent.MockAgent">
        function <span class="apidocSignatureSpan">apnagent.</span>MockAgent
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Mock() {
  Base.call(this);

  // Messages sent to these devices will be rejected with error 8 BAD_TOKEN
  this.badDevices = []
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.MockAgent._super" id="apidoc.element.apnagent.MockAgent._super">
        function <span class="apidocSignatureSpan">apnagent.MockAgent.</span>_super
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Base() {
  EventEmitter.call(this, { delimeter: ':' });
  this.connected = false;

  // default settings
  this.set('cache ttl', '10m');
  this.set('codec', 'enhanced');
  this.set('expires', 0);
  this.enable('reconnect');
  this.set('reconnect delay', 3000);
  this.disable('sandbox');

  // internal storage
  this.meta = {};
  this.meta.lastId = -1;
  this.meta.gatewayError = null;
  this.meta.timer = null;

  var self = this
    , cache, decoder, encoder, queue;

  // temp storage for messages
  cache = new Cache();

  // queue handles writing buffers to gateway
  queue = new Queue(function () {
    debug('(queue) iterate');
    self._queueIterator.apply(self, arguments);
  }, 1);

  // start in paused state
  cache.pause();
  queue.pause();

  // emit queue errors on agent
  queue.onerror = function (err) {
    debug('(queue) error: %s', err.message);
    self.emit('queue:error', err);
  };

  // emit queue drain on agent
  queue.drain = function () {
    debug('(queue) drain');
    self.emit('queue:drain');
  };

  // decoder handles incoming apn errors
  decoder = lotus.createDecoder();
  decoder.stream(8, codecs.getInterface('gateway response', 'decode'));

  // listen for responses
  decoder.stream(8).on('readable', function () {
    var obj = this.read();
    obj.code = obj.code[0];

    var message = notifErrors[obj.code] || 'None (unknown)'
      , err = new errors.GatewayMessageError(message, obj)
      , cached = self.cache.get(obj.identifier)
      , msg = null;

    if (cached) {
      msg = new Message(self, 'enhanced', cached.json.payload);
      msg.device(cached.json.deviceToken);
      msg.meta.expires = cached.json.expiration;
    }

    debug('(message) error: %s', err.message);
    self.meta.gatewayError = err;
    self.emit('message:error', err, msg);
  });

  // encoder handles converting msg json to buffers
  encoder = lotus.createEncoder();
  encoder.stream(0, codecs.getInterface('gateway simple', 'encode'));
  encoder.stream(1, codecs.getInterface('gateway enhanced', 'encode'));

  // mount objects
  this.cache = cache;
  this.decoder = decoder;
  this.encoder = encoder;
  this.gateway = null;
  this.queue = queue;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.MockAgent.prototype" id="apidoc.module.apnagent.MockAgent.prototype">module apnagent.MockAgent.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.MockAgent.prototype._queueIterator" id="apidoc.element.apnagent.MockAgent.prototype._queueIterator">
        function <span class="apidocSignatureSpan">apnagent.MockAgent.prototype.</span>_queueIterator
        <span class="apidocSignatureSpan">(obj, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_queueIterator = function (obj, next) {
  var self = this
    , cache = this.cache
    , encoder = this.encoder
    , stream = encoder.stream(obj.codec)
    , id = obj.json.identifier
    , queue = this.queue;

  // wait for encoded message
  encoder.once('readable', function () {
    var buf = encoder.read()
      , gateway = self.gateway;

    // requeue if not connected
    if (!gateway || !gateway.writable || !self.connected) {
      debug('(queue) pause: not connected');
      queue.pause();
      queue.pushAt(0, obj);
      return next();
    }

    debug('(gateway) write: %d', id);
    gateway.write(buf);
    process.nextTick(function () {
      debug('(cache) push: %d', id);
      cache.push(id, obj);
      next();
    });
  });

  // encode message
  debug('(encoder) write: %d', id);
  stream.write(obj.json);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.MockAgent.prototype.close" id="apidoc.element.apnagent.MockAgent.prototype.close">
        function <span class="apidocSignatureSpan">apnagent.MockAgent.prototype.</span>close
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">close = function (cb) {
  cb = cb || function () {};

  // leave if nothing needs to be done
  if (!this.connected || !this.gateway) {
    clearTimeout(this.meta.timer);
    process.nextTick(cb);
    return this;
  }

  var self = this
    , drain = this.queue.drain;

  // wait for queue to finish processing current
  this.queue.drain = function () {
    debug('(gateway) disconnecting');
    self.cache.pause();
    process.nextTick(cb);
    self.gateway.end();
    self.queue.drain = drain;
  };

  // set things in motion
  this.connected = false;
  this.queue.pause();
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.MockAgent.prototype.connect" id="apidoc.element.apnagent.MockAgent.prototype.connect">
        function <span class="apidocSignatureSpan">apnagent.MockAgent.prototype.</span>connect
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">connect = function (cb) {
  cb = cb || function () {};

  var self = this
    , delay = this.get('reconnect delay')
    , opts = util.gatewayOptions(this)
    , recon = this.enabled('reconnect')
    , ttl = this.get('cache ttl')
    , gateway;

  // how to perform a reconnect
  function reconnect () {
    var gwe = self.meta.gatewayError
      , pos = 0;

    if (gwe &amp;&amp; 'undefined' !== typeof gwe.identifier) {
      debug('(cache) since: %d', gwe.identifier);
      self.cache.sinceId(gwe.identifier, function (obj, id) {
        debug('(queue) push: %d', id);
        self.queue.pushAt(pos++, obj);
      });
    }

    debug('(gateway) reconnecting');
    self.connect(function (err) {
      if (err) return;
      debug('(gateway) reconnected');
      self.emit('gateway:reconnect');
    });
  }

  // reset state
  this.meta.gatewayError = null;

  // mock gateway parses the outgoing buffers back to json
  gateway = lotus.createDecoder();
  gateway.stream(0, codecs.getInterface('gateway simple', 'decode'));
  gateway.stream(1, codecs.getInterface('gateway enhanced', 'decode'));

  // simulate async connect
  debug('(gateway) connecting - mock');
  process.nextTick(function () {
    debug('(gateway) connected - mock');
    self.connected = true;
    self.cache.ttl = ttl;
    self.cache.resume();
    self.queue.resume();
    self.emit('gateway:connect');
    cb();
  });

  function shouldBeRejected (msgJson) {
    msgDevice = new Device(msgJson.deviceToken);
    reject = false;
    for (var i = 0; i &lt; self.badDevices.length; i++) {
      reject = self.badDevices[i].equal(msgDevice)
    }
    return reject;
  }

  // data event is emitted for each message
  function emitter () {
    var json = this.read();
    if (!json) return;

    // Simulate message error at Apple side
    if (shouldBeRejected(json)) {
      var err = new errors.GatewayMessageError("Invalid token", {code: 8})
      self.meta.gatewayError = err;

      debug('(gateway) incoming message error', err.toJSON(false));
      self.emit('message:error', err, json);
      gateway.end();
    } else {
      debug('(gateway) incoming message', json);
      self.emit('mock:message', json);
    }
  }

  gateway.stream(0).on('readable', emitter);
  gateway.stream(1).on('readable', emitter);

  // an error is emitted when an incoming message is badly formatted
  gateway.on('error', function (err) {
    debug('(gateway) error: %s', err.message || 'Unspecified Error');
    self.emit('gateway:error', err);
  });

  // this is similiar to a socket `close` event
  gateway.on('close', function () {
    self.cache.pause();
    self.queue.pause();
    self.gateway = null;

    if (self.connected &amp;&amp; recon) {
      debug('(gateway) disconnected - mock');
      self.connected = false;
      self.meta.timer = setTimeout(reconnect, ms(delay));
    } else {
      debug('(gateway) closed - mock');
      self.connected = false;
      self.emit('gateway:close');
    }
  });

  // mount
  this.gateway = gateway;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.MockAgent.prototype.setBadDevices" id="apidoc.element.apnagent.MockAgent.prototype.setBadDevices">
        function <span class="apidocSignatureSpan">apnagent.MockAgent.prototype.</span>setBadDevices
        <span class="apidocSignatureSpan">(devices)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setBadDevices = function (devices) {
  // Validate input, crash early if smth is wrong -
  // better than search for a bug somewhere deep in code
  if (!(devices instanceof Array)) {
    throw new Error('Parameter "devices" should be an array of Device');
  } else {
    for (var i = 0; i &lt; devices.length; i++) {
      if (!(devices[i] instanceof Device)) {
        throw new Error('Parameter "devices" should be an array of Device')
      }
    }
  }

  // All good
  this.badDevices = devices;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.MockAgent.prototype._queueIterator" id="apidoc.module.apnagent.MockAgent.prototype._queueIterator">module apnagent.MockAgent.prototype._queueIterator</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.MockAgent.prototype._queueIterator._queueIterator" id="apidoc.element.apnagent.MockAgent.prototype._queueIterator._queueIterator">
        function <span class="apidocSignatureSpan">apnagent.MockAgent.prototype.</span>_queueIterator
        <span class="apidocSignatureSpan">(obj, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_queueIterator = function (obj, next) {
  var self = this
    , cache = this.cache
    , encoder = this.encoder
    , stream = encoder.stream(obj.codec)
    , id = obj.json.identifier
    , queue = this.queue;

  // wait for encoded message
  encoder.once('readable', function () {
    var buf = encoder.read()
      , gateway = self.gateway;

    // requeue if not connected
    if (!gateway || !gateway.writable || !self.connected) {
      debug('(queue) pause: not connected');
      queue.pause();
      queue.pushAt(0, obj);
      return next();
    }

    debug('(gateway) write: %d', id);
    gateway.write(buf);
    process.nextTick(function () {
      debug('(cache) push: %d', id);
      cache.push(id, obj);
      next();
    });
  });

  // encode message
  debug('(encoder) write: %d', id);
  stream.write(obj.json);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.MockAgent.prototype.close" id="apidoc.module.apnagent.MockAgent.prototype.close">module apnagent.MockAgent.prototype.close</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.MockAgent.prototype.close.close" id="apidoc.element.apnagent.MockAgent.prototype.close.close">
        function <span class="apidocSignatureSpan">apnagent.MockAgent.prototype.</span>close
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">close = function (cb) {
  cb = cb || function () {};

  // leave if nothing needs to be done
  if (!this.connected || !this.gateway) {
    clearTimeout(this.meta.timer);
    process.nextTick(cb);
    return this;
  }

  var self = this
    , drain = this.queue.drain;

  // wait for queue to finish processing current
  this.queue.drain = function () {
    debug('(gateway) disconnecting');
    self.cache.pause();
    process.nextTick(cb);
    self.gateway.end();
    self.queue.drain = drain;
  };

  // set things in motion
  this.connected = false;
  this.queue.pause();
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.MockAgent.prototype.connect" id="apidoc.module.apnagent.MockAgent.prototype.connect">module apnagent.MockAgent.prototype.connect</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.MockAgent.prototype.connect.connect" id="apidoc.element.apnagent.MockAgent.prototype.connect.connect">
        function <span class="apidocSignatureSpan">apnagent.MockAgent.prototype.</span>connect
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">connect = function (cb) {
  cb = cb || function () {};

  var self = this
    , delay = this.get('reconnect delay')
    , opts = util.gatewayOptions(this)
    , recon = this.enabled('reconnect')
    , ttl = this.get('cache ttl')
    , gateway;

  // how to perform a reconnect
  function reconnect () {
    var gwe = self.meta.gatewayError
      , pos = 0;

    if (gwe &amp;&amp; 'undefined' !== typeof gwe.identifier) {
      debug('(cache) since: %d', gwe.identifier);
      self.cache.sinceId(gwe.identifier, function (obj, id) {
        debug('(queue) push: %d', id);
        self.queue.pushAt(pos++, obj);
      });
    }

    debug('(gateway) reconnecting');
    self.connect(function (err) {
      if (err) return;
      debug('(gateway) reconnected');
      self.emit('gateway:reconnect');
    });
  }

  // reset state
  this.meta.gatewayError = null;

  // mock gateway parses the outgoing buffers back to json
  gateway = lotus.createDecoder();
  gateway.stream(0, codecs.getInterface('gateway simple', 'decode'));
  gateway.stream(1, codecs.getInterface('gateway enhanced', 'decode'));

  // simulate async connect
  debug('(gateway) connecting - mock');
  process.nextTick(function () {
    debug('(gateway) connected - mock');
    self.connected = true;
    self.cache.ttl = ttl;
    self.cache.resume();
    self.queue.resume();
    self.emit('gateway:connect');
    cb();
  });

  function shouldBeRejected (msgJson) {
    msgDevice = new Device(msgJson.deviceToken);
    reject = false;
    for (var i = 0; i &lt; self.badDevices.length; i++) {
      reject = self.badDevices[i].equal(msgDevice)
    }
    return reject;
  }

  // data event is emitted for each message
  function emitter () {
    var json = this.read();
    if (!json) return;

    // Simulate message error at Apple side
    if (shouldBeRejected(json)) {
      var err = new errors.GatewayMessageError("Invalid token", {code: 8})
      self.meta.gatewayError = err;

      debug('(gateway) incoming message error', err.toJSON(false));
      self.emit('message:error', err, json);
      gateway.end();
    } else {
      debug('(gateway) incoming message', json);
      self.emit('mock:message', json);
    }
  }

  gateway.stream(0).on('readable', emitter);
  gateway.stream(1).on('readable', emitter);

  // an error is emitted when an incoming message is badly formatted
  gateway.on('error', function (err) {
    debug('(gateway) error: %s', err.message || 'Unspecified Error');
    self.emit('gateway:error', err);
  });

  // this is similiar to a socket `close` event
  gateway.on('close', function () {
    self.cache.pause();
    self.queue.pause();
    self.gateway = null;

    if (self.connected &amp;&amp; recon) {
      debug('(gateway) disconnected - mock');
      self.connected = false;
      self.meta.timer = setTimeout(reconnect, ms(delay));
    } else {
      debug('(gateway) closed - mock');
      self.connected = false;
      self.emit('gateway:close');
    }
  });

  // mount
  this.gateway = gateway;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.MockAgent.prototype.setBadDevices" id="apidoc.module.apnagent.MockAgent.prototype.setBadDevices">module apnagent.MockAgent.prototype.setBadDevices</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.MockAgent.prototype.setBadDevices.setBadDevices" id="apidoc.element.apnagent.MockAgent.prototype.setBadDevices.setBadDevices">
        function <span class="apidocSignatureSpan">apnagent.MockAgent.prototype.</span>setBadDevices
        <span class="apidocSignatureSpan">(devices)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setBadDevices = function (devices) {
  // Validate input, crash early if smth is wrong -
  // better than search for a bug somewhere deep in code
  if (!(devices instanceof Array)) {
    throw new Error('Parameter "devices" should be an array of Device');
  } else {
    for (var i = 0; i &lt; devices.length; i++) {
      if (!(devices[i] instanceof Device)) {
        throw new Error('Parameter "devices" should be an array of Device')
      }
    }
  }

  // All good
  this.badDevices = devices;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.MockFeedback" id="apidoc.module.apnagent.MockFeedback">module apnagent.MockFeedback</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.MockFeedback.MockFeedback" id="apidoc.element.apnagent.MockFeedback.MockFeedback">
        function <span class="apidocSignatureSpan">apnagent.</span>MockFeedback
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Mock() {
  Base.call(this);
  this.meta.outgoing = [];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.MockFeedback._super" id="apidoc.element.apnagent.MockFeedback._super">
        function <span class="apidocSignatureSpan">apnagent.MockFeedback.</span>_super
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Base() {
  EventEmitter.call(this, { delimeter: ':' });
  this.connected = false;
  this.set('interval', '30m');
  this.disable('sandbox');

  this.meta = {};
  this.meta.timer = null;
  this.meta.stack = [ emit ];

  var self = this
    , decoder, queue;

  // queue handles user interaction with responses
  queue = new Queue(function (obj, done) {
    var device = obj.device
      , stack = self.meta.stack
      , timestamp = obj.timestamp;

    // intercept errors so as not to cancel queue
    function finish (err) {
      if (err) {
        debug('(iterate) error - %s', err.message);
        self.emit('iterate:error', err, device, timestamp);
      }

      debug('(iterate) end - %s', device.toString());
      done();
    }

    // start iteration
    debug('(iterate) start - %s', device.toString());
    series(stack, function (fn, next) {
      fn.apply(self, [ device, timestamp, next ]);
    }, finish);
  }, 10);

  // emit queue errors on feedback agent
  queue.onerror = function (err) {
    debug('(queue) error: %s', err.message);
    self.emit('queue:error', err);
  };

  // emit queue drain on feedback agent
  queue.drain = function () {
    debug('(queue) drain');
    self.emit('queue:drain');
  };

  // decoder handing incoming feedback responses
  decoder = lotus.createDecoder();
  decoder.stream(codecs.getInterface('feedback response', 'decode'));
  decoder.stream().on('readable', function () {
    var obj = this.read()
      , res = {};
    res.device = new Device(obj.deviceToken);
    res.timestamp = new Date(obj.timestamp * 1000);
    queue.push(res, true);
  });

  this.decoder = decoder;
  this.feedback = null;
  this.queue = queue;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.MockFeedback.prototype" id="apidoc.module.apnagent.MockFeedback.prototype">module apnagent.MockFeedback.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.MockFeedback.prototype.close" id="apidoc.element.apnagent.MockFeedback.prototype.close">
        function <span class="apidocSignatureSpan">apnagent.MockFeedback.prototype.</span>close
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">close = function (cb) {
  cb = cb || function () {};

  // if not connected, cancel reconnect time
  if (!this.connected || !this.feedback) {
    clearTimeout(this.meta.timer);
    process.nextTick(cb);
    return this;
  }

  // wait for feedback to finish download
  this.feedback.once('end', cb);
  this.connected = false;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.MockFeedback.prototype.connect" id="apidoc.element.apnagent.MockFeedback.prototype.connect">
        function <span class="apidocSignatureSpan">apnagent.MockFeedback.prototype.</span>connect
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">connect = function (cb) {
  cb = cb || function () {};

  var self = this
    , interval = this.get('interval')
    , opts = util.feedbackOptions(this)
    , feedback;

  // how to perform a reconnect
  function reconnect () {
    debug('(feedback) reconnecting');
    self.connect(function (err) {
      if (err) return;
      debug('(feedback) reconnected');
      self.emit('feedback:reconnect');
    });
  }

  // mock feedback writes mock unsubs to decoder
  feedback = lotus.createEncoder();
  feedback.stream(codecs.getInterface('feedback response', 'encode'));

  // simulate async connect
  debug('(feedback) connecting - mock');
  process.nextTick(function () {
    debug('(feedback) connected - mock');
    self.connected = true;
    self.emit('feedback:connect');
    cb();

    // send simulated data
    setTimeout(function () {
      var outgoing = self.meta.outgoing
        , stream = feedback.stream()
        , line;

      debug('(mock) simulating [%d] unsubs', outgoing.length);
      while (outgoing.length) {
        line = outgoing.shift();
        debug('(mock) writing unsub - %s', line.deviceToken.toString('hex'));
        stream.write(line);
      }

      debug('(mock) writing complete');
      stream.end();
    }, 10);
  });

  // handle "incoming" data
  feedback.on('data', function (buf) {
    debug('(feedback) data: %d bytes, buf.length');
    self.decoder.write(buf);
  });

  // emit errors;
  feedback.on('error', function (err) {
    debug('(feedback) error: %s', err.message || 'Unspecified Error');
    self.emit('feedback:error', err);
  });

  // end is similiar to a socket `close` event
  feedback.on('end', function () {
    self.feedback = null;

    if (self.connected) {
      debug('(feedback) disconnected - %s:%d', opts.host, opts.port);
      self.connected = false;
      self.meta.timer = setTimeout(reconnect, ms(interval));
    } else {
      debug('(feedback) closed - %s:%d', opts.host, opts.port);
      self.connected = false;
      self.emit('feedback:close');
    }
  });

  // mount
  this.feedback = feedback;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.MockFeedback.prototype.unsub" id="apidoc.element.apnagent.MockFeedback.prototype.unsub">
        function <span class="apidocSignatureSpan">apnagent.MockFeedback.prototype.</span>unsub
        <span class="apidocSignatureSpan">(token, ts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unsub = function (token, ts) {
  var device = new Device(token)
    , timestamp;

  // figure out time
  if (ts &amp;&amp; 'number' === typeof ts) {
    timestamp = ts;
  } else if (ts &amp;&amp; 'string' === typeof ts) {
    timestamp = ms.unix(ts);
  } else if (ts &amp;&amp; ts instanceof Date) {
    timestamp = ts.getTime() / 1000;
  } else {
    timestamp = ms.unix('-1s');
  }

  // add to outgoing queue
  this.meta.outgoing.push({
      deviceToken: device.toBuffer()
    , timestamp: timestamp
  });

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.MockFeedback.prototype.close" id="apidoc.module.apnagent.MockFeedback.prototype.close">module apnagent.MockFeedback.prototype.close</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.MockFeedback.prototype.close.close" id="apidoc.element.apnagent.MockFeedback.prototype.close.close">
        function <span class="apidocSignatureSpan">apnagent.MockFeedback.prototype.</span>close
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">close = function (cb) {
  cb = cb || function () {};

  // if not connected, cancel reconnect time
  if (!this.connected || !this.feedback) {
    clearTimeout(this.meta.timer);
    process.nextTick(cb);
    return this;
  }

  // wait for feedback to finish download
  this.feedback.once('end', cb);
  this.connected = false;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.MockFeedback.prototype.connect" id="apidoc.module.apnagent.MockFeedback.prototype.connect">module apnagent.MockFeedback.prototype.connect</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.MockFeedback.prototype.connect.connect" id="apidoc.element.apnagent.MockFeedback.prototype.connect.connect">
        function <span class="apidocSignatureSpan">apnagent.MockFeedback.prototype.</span>connect
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">connect = function (cb) {
  cb = cb || function () {};

  var self = this
    , interval = this.get('interval')
    , opts = util.feedbackOptions(this)
    , feedback;

  // how to perform a reconnect
  function reconnect () {
    debug('(feedback) reconnecting');
    self.connect(function (err) {
      if (err) return;
      debug('(feedback) reconnected');
      self.emit('feedback:reconnect');
    });
  }

  // mock feedback writes mock unsubs to decoder
  feedback = lotus.createEncoder();
  feedback.stream(codecs.getInterface('feedback response', 'encode'));

  // simulate async connect
  debug('(feedback) connecting - mock');
  process.nextTick(function () {
    debug('(feedback) connected - mock');
    self.connected = true;
    self.emit('feedback:connect');
    cb();

    // send simulated data
    setTimeout(function () {
      var outgoing = self.meta.outgoing
        , stream = feedback.stream()
        , line;

      debug('(mock) simulating [%d] unsubs', outgoing.length);
      while (outgoing.length) {
        line = outgoing.shift();
        debug('(mock) writing unsub - %s', line.deviceToken.toString('hex'));
        stream.write(line);
      }

      debug('(mock) writing complete');
      stream.end();
    }, 10);
  });

  // handle "incoming" data
  feedback.on('data', function (buf) {
    debug('(feedback) data: %d bytes, buf.length');
    self.decoder.write(buf);
  });

  // emit errors;
  feedback.on('error', function (err) {
    debug('(feedback) error: %s', err.message || 'Unspecified Error');
    self.emit('feedback:error', err);
  });

  // end is similiar to a socket `close` event
  feedback.on('end', function () {
    self.feedback = null;

    if (self.connected) {
      debug('(feedback) disconnected - %s:%d', opts.host, opts.port);
      self.connected = false;
      self.meta.timer = setTimeout(reconnect, ms(interval));
    } else {
      debug('(feedback) closed - %s:%d', opts.host, opts.port);
      self.connected = false;
      self.emit('feedback:close');
    }
  });

  // mount
  this.feedback = feedback;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.MockFeedback.prototype.unsub" id="apidoc.module.apnagent.MockFeedback.prototype.unsub">module apnagent.MockFeedback.prototype.unsub</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.MockFeedback.prototype.unsub.unsub" id="apidoc.element.apnagent.MockFeedback.prototype.unsub.unsub">
        function <span class="apidocSignatureSpan">apnagent.MockFeedback.prototype.</span>unsub
        <span class="apidocSignatureSpan">(token, ts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unsub = function (token, ts) {
  var device = new Device(token)
    , timestamp;

  // figure out time
  if (ts &amp;&amp; 'number' === typeof ts) {
    timestamp = ts;
  } else if (ts &amp;&amp; 'string' === typeof ts) {
    timestamp = ms.unix(ts);
  } else if (ts &amp;&amp; ts instanceof Date) {
    timestamp = ts.getTime() / 1000;
  } else {
    timestamp = ms.unix('-1s');
  }

  // add to outgoing queue
  this.meta.outgoing.push({
      deviceToken: device.toBuffer()
    , timestamp: timestamp
  });

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.errors" id="apidoc.module.apnagent.errors">module apnagent.errors</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.errors.FeedbackAuthorizationError" id="apidoc.element.apnagent.errors.FeedbackAuthorizationError">
        function <span class="apidocSignatureSpan">apnagent.errors.</span>FeedbackAuthorizationError
        <span class="apidocSignatureSpan">(message, props, ssf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ErrorProto(message, props, ssf) {
  var exclude = extend.exclude('name', 'message', 'stack')
    , props = exclude(props || {});

  this.message = message || ('Unspecified ' + name);
  extend(this, props);

  ssf = ssf || arguments.callee;
  if (ssf &amp;&amp; Error.captureStackTrace) {
    Error.captureStackTrace(this, ssf);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.errors.GatewayAuthorizationError" id="apidoc.element.apnagent.errors.GatewayAuthorizationError">
        function <span class="apidocSignatureSpan">apnagent.errors.</span>GatewayAuthorizationError
        <span class="apidocSignatureSpan">(message, props, ssf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ErrorProto(message, props, ssf) {
  var exclude = extend.exclude('name', 'message', 'stack')
    , props = exclude(props || {});

  this.message = message || ('Unspecified ' + name);
  extend(this, props);

  ssf = ssf || arguments.callee;
  if (ssf &amp;&amp; Error.captureStackTrace) {
    Error.captureStackTrace(this, ssf);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.errors.GatewayMessageError" id="apidoc.element.apnagent.errors.GatewayMessageError">
        function <span class="apidocSignatureSpan">apnagent.errors.</span>GatewayMessageError
        <span class="apidocSignatureSpan">(message, props, ssf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ErrorProto(message, props, ssf) {
  var exclude = extend.exclude('name', 'message', 'stack')
    , props = exclude(props || {});

  this.message = message || ('Unspecified ' + name);
  extend(this, props);

  ssf = ssf || arguments.callee;
  if (ssf &amp;&amp; Error.captureStackTrace) {
    Error.captureStackTrace(this, ssf);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.errors.MessageSerializationError" id="apidoc.element.apnagent.errors.MessageSerializationError">
        function <span class="apidocSignatureSpan">apnagent.errors.</span>MessageSerializationError
        <span class="apidocSignatureSpan">(message, props, ssf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ErrorProto(message, props, ssf) {
  var exclude = extend.exclude('name', 'message', 'stack')
    , props = exclude(props || {});

  this.message = message || ('Unspecified ' + name);
  extend(this, props);

  ssf = ssf || arguments.callee;
  if (ssf &amp;&amp; Error.captureStackTrace) {
    Error.captureStackTrace(this, ssf);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.errors.FeedbackAuthorizationError" id="apidoc.module.apnagent.errors.FeedbackAuthorizationError">module apnagent.errors.FeedbackAuthorizationError</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.errors.FeedbackAuthorizationError.FeedbackAuthorizationError" id="apidoc.element.apnagent.errors.FeedbackAuthorizationError.FeedbackAuthorizationError">
        function <span class="apidocSignatureSpan">apnagent.errors.</span>FeedbackAuthorizationError
        <span class="apidocSignatureSpan">(message, props, ssf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ErrorProto(message, props, ssf) {
  var exclude = extend.exclude('name', 'message', 'stack')
    , props = exclude(props || {});

  this.message = message || ('Unspecified ' + name);
  extend(this, props);

  ssf = ssf || arguments.callee;
  if (ssf &amp;&amp; Error.captureStackTrace) {
    Error.captureStackTrace(this, ssf);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.errors.FeedbackAuthorizationError.prototype" id="apidoc.module.apnagent.errors.FeedbackAuthorizationError.prototype">module apnagent.errors.FeedbackAuthorizationError.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.errors.FeedbackAuthorizationError.prototype.constructor" id="apidoc.element.apnagent.errors.FeedbackAuthorizationError.prototype.constructor">
        function <span class="apidocSignatureSpan">apnagent.errors.FeedbackAuthorizationError.prototype.</span>constructor
        <span class="apidocSignatureSpan">(message, props, ssf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ErrorProto(message, props, ssf) {
  var exclude = extend.exclude('name', 'message', 'stack')
    , props = exclude(props || {});

  this.message = message || ('Unspecified ' + name);
  extend(this, props);

  ssf = ssf || arguments.callee;
  if (ssf &amp;&amp; Error.captureStackTrace) {
    Error.captureStackTrace(this, ssf);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.errors.FeedbackAuthorizationError.prototype.serialize" id="apidoc.element.apnagent.errors.FeedbackAuthorizationError.prototype.serialize">
        function <span class="apidocSignatureSpan">apnagent.errors.FeedbackAuthorizationError.prototype.</span>serialize
        <span class="apidocSignatureSpan">(stack)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">serialize = function (stack) {
  var exclude = extend.exclude('constructor', 'serialize', 'toJSON', 'stack')
    , props = exclude({ name: this.name }, this);

  if (false !== stack &amp;&amp; this.stack) {
    props.stack = this.stack;
  }

  return props;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.errors.FeedbackAuthorizationError.prototype.toJSON" id="apidoc.element.apnagent.errors.FeedbackAuthorizationError.prototype.toJSON">
        function <span class="apidocSignatureSpan">apnagent.errors.FeedbackAuthorizationError.prototype.</span>toJSON
        <span class="apidocSignatureSpan">(stack)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toJSON = function (stack) {
  var exclude = extend.exclude('constructor', 'serialize', 'toJSON', 'stack')
    , props = exclude({ name: this.name }, this);

  if (false !== stack &amp;&amp; this.stack) {
    props.stack = this.stack;
  }

  return props;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.errors.FeedbackAuthorizationError.prototype.serialize" id="apidoc.module.apnagent.errors.FeedbackAuthorizationError.prototype.serialize">module apnagent.errors.FeedbackAuthorizationError.prototype.serialize</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.errors.FeedbackAuthorizationError.prototype.serialize.serialize" id="apidoc.element.apnagent.errors.FeedbackAuthorizationError.prototype.serialize.serialize">
        function <span class="apidocSignatureSpan">apnagent.errors.FeedbackAuthorizationError.prototype.</span>serialize
        <span class="apidocSignatureSpan">(stack)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">serialize = function (stack) {
  var exclude = extend.exclude('constructor', 'serialize', 'toJSON', 'stack')
    , props = exclude({ name: this.name }, this);

  if (false !== stack &amp;&amp; this.stack) {
    props.stack = this.stack;
  }

  return props;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.errors.GatewayAuthorizationError" id="apidoc.module.apnagent.errors.GatewayAuthorizationError">module apnagent.errors.GatewayAuthorizationError</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.errors.GatewayAuthorizationError.GatewayAuthorizationError" id="apidoc.element.apnagent.errors.GatewayAuthorizationError.GatewayAuthorizationError">
        function <span class="apidocSignatureSpan">apnagent.errors.</span>GatewayAuthorizationError
        <span class="apidocSignatureSpan">(message, props, ssf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ErrorProto(message, props, ssf) {
  var exclude = extend.exclude('name', 'message', 'stack')
    , props = exclude(props || {});

  this.message = message || ('Unspecified ' + name);
  extend(this, props);

  ssf = ssf || arguments.callee;
  if (ssf &amp;&amp; Error.captureStackTrace) {
    Error.captureStackTrace(this, ssf);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.errors.GatewayAuthorizationError.prototype" id="apidoc.module.apnagent.errors.GatewayAuthorizationError.prototype">module apnagent.errors.GatewayAuthorizationError.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.errors.GatewayAuthorizationError.prototype.constructor" id="apidoc.element.apnagent.errors.GatewayAuthorizationError.prototype.constructor">
        function <span class="apidocSignatureSpan">apnagent.errors.GatewayAuthorizationError.prototype.</span>constructor
        <span class="apidocSignatureSpan">(message, props, ssf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ErrorProto(message, props, ssf) {
  var exclude = extend.exclude('name', 'message', 'stack')
    , props = exclude(props || {});

  this.message = message || ('Unspecified ' + name);
  extend(this, props);

  ssf = ssf || arguments.callee;
  if (ssf &amp;&amp; Error.captureStackTrace) {
    Error.captureStackTrace(this, ssf);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.errors.GatewayAuthorizationError.prototype.serialize" id="apidoc.element.apnagent.errors.GatewayAuthorizationError.prototype.serialize">
        function <span class="apidocSignatureSpan">apnagent.errors.GatewayAuthorizationError.prototype.</span>serialize
        <span class="apidocSignatureSpan">(stack)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">serialize = function (stack) {
  var exclude = extend.exclude('constructor', 'serialize', 'toJSON', 'stack')
    , props = exclude({ name: this.name }, this);

  if (false !== stack &amp;&amp; this.stack) {
    props.stack = this.stack;
  }

  return props;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.errors.GatewayAuthorizationError.prototype.toJSON" id="apidoc.element.apnagent.errors.GatewayAuthorizationError.prototype.toJSON">
        function <span class="apidocSignatureSpan">apnagent.errors.GatewayAuthorizationError.prototype.</span>toJSON
        <span class="apidocSignatureSpan">(stack)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toJSON = function (stack) {
  var exclude = extend.exclude('constructor', 'serialize', 'toJSON', 'stack')
    , props = exclude({ name: this.name }, this);

  if (false !== stack &amp;&amp; this.stack) {
    props.stack = this.stack;
  }

  return props;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.errors.GatewayAuthorizationError.prototype.serialize" id="apidoc.module.apnagent.errors.GatewayAuthorizationError.prototype.serialize">module apnagent.errors.GatewayAuthorizationError.prototype.serialize</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.errors.GatewayAuthorizationError.prototype.serialize.serialize" id="apidoc.element.apnagent.errors.GatewayAuthorizationError.prototype.serialize.serialize">
        function <span class="apidocSignatureSpan">apnagent.errors.GatewayAuthorizationError.prototype.</span>serialize
        <span class="apidocSignatureSpan">(stack)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">serialize = function (stack) {
  var exclude = extend.exclude('constructor', 'serialize', 'toJSON', 'stack')
    , props = exclude({ name: this.name }, this);

  if (false !== stack &amp;&amp; this.stack) {
    props.stack = this.stack;
  }

  return props;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.errors.GatewayMessageError" id="apidoc.module.apnagent.errors.GatewayMessageError">module apnagent.errors.GatewayMessageError</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.errors.GatewayMessageError.GatewayMessageError" id="apidoc.element.apnagent.errors.GatewayMessageError.GatewayMessageError">
        function <span class="apidocSignatureSpan">apnagent.errors.</span>GatewayMessageError
        <span class="apidocSignatureSpan">(message, props, ssf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ErrorProto(message, props, ssf) {
  var exclude = extend.exclude('name', 'message', 'stack')
    , props = exclude(props || {});

  this.message = message || ('Unspecified ' + name);
  extend(this, props);

  ssf = ssf || arguments.callee;
  if (ssf &amp;&amp; Error.captureStackTrace) {
    Error.captureStackTrace(this, ssf);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.errors.GatewayMessageError.prototype" id="apidoc.module.apnagent.errors.GatewayMessageError.prototype">module apnagent.errors.GatewayMessageError.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.errors.GatewayMessageError.prototype.constructor" id="apidoc.element.apnagent.errors.GatewayMessageError.prototype.constructor">
        function <span class="apidocSignatureSpan">apnagent.errors.GatewayMessageError.prototype.</span>constructor
        <span class="apidocSignatureSpan">(message, props, ssf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ErrorProto(message, props, ssf) {
  var exclude = extend.exclude('name', 'message', 'stack')
    , props = exclude(props || {});

  this.message = message || ('Unspecified ' + name);
  extend(this, props);

  ssf = ssf || arguments.callee;
  if (ssf &amp;&amp; Error.captureStackTrace) {
    Error.captureStackTrace(this, ssf);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.errors.GatewayMessageError.prototype.serialize" id="apidoc.element.apnagent.errors.GatewayMessageError.prototype.serialize">
        function <span class="apidocSignatureSpan">apnagent.errors.GatewayMessageError.prototype.</span>serialize
        <span class="apidocSignatureSpan">(stack)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">serialize = function (stack) {
  var exclude = extend.exclude('constructor', 'serialize', 'toJSON', 'stack')
    , props = exclude({ name: this.name }, this);

  if (false !== stack &amp;&amp; this.stack) {
    props.stack = this.stack;
  }

  return props;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.errors.GatewayMessageError.prototype.toJSON" id="apidoc.element.apnagent.errors.GatewayMessageError.prototype.toJSON">
        function <span class="apidocSignatureSpan">apnagent.errors.GatewayMessageError.prototype.</span>toJSON
        <span class="apidocSignatureSpan">(stack)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toJSON = function (stack) {
  var exclude = extend.exclude('constructor', 'serialize', 'toJSON', 'stack')
    , props = exclude({ name: this.name }, this);

  if (false !== stack &amp;&amp; this.stack) {
    props.stack = this.stack;
  }

  return props;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.errors.GatewayMessageError.prototype.serialize" id="apidoc.module.apnagent.errors.GatewayMessageError.prototype.serialize">module apnagent.errors.GatewayMessageError.prototype.serialize</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.errors.GatewayMessageError.prototype.serialize.serialize" id="apidoc.element.apnagent.errors.GatewayMessageError.prototype.serialize.serialize">
        function <span class="apidocSignatureSpan">apnagent.errors.GatewayMessageError.prototype.</span>serialize
        <span class="apidocSignatureSpan">(stack)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">serialize = function (stack) {
  var exclude = extend.exclude('constructor', 'serialize', 'toJSON', 'stack')
    , props = exclude({ name: this.name }, this);

  if (false !== stack &amp;&amp; this.stack) {
    props.stack = this.stack;
  }

  return props;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.errors.MessageSerializationError" id="apidoc.module.apnagent.errors.MessageSerializationError">module apnagent.errors.MessageSerializationError</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.errors.MessageSerializationError.MessageSerializationError" id="apidoc.element.apnagent.errors.MessageSerializationError.MessageSerializationError">
        function <span class="apidocSignatureSpan">apnagent.errors.</span>MessageSerializationError
        <span class="apidocSignatureSpan">(message, props, ssf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ErrorProto(message, props, ssf) {
  var exclude = extend.exclude('name', 'message', 'stack')
    , props = exclude(props || {});

  this.message = message || ('Unspecified ' + name);
  extend(this, props);

  ssf = ssf || arguments.callee;
  if (ssf &amp;&amp; Error.captureStackTrace) {
    Error.captureStackTrace(this, ssf);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.errors.MessageSerializationError.prototype" id="apidoc.module.apnagent.errors.MessageSerializationError.prototype">module apnagent.errors.MessageSerializationError.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.errors.MessageSerializationError.prototype.constructor" id="apidoc.element.apnagent.errors.MessageSerializationError.prototype.constructor">
        function <span class="apidocSignatureSpan">apnagent.errors.MessageSerializationError.prototype.</span>constructor
        <span class="apidocSignatureSpan">(message, props, ssf)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ErrorProto(message, props, ssf) {
  var exclude = extend.exclude('name', 'message', 'stack')
    , props = exclude(props || {});

  this.message = message || ('Unspecified ' + name);
  extend(this, props);

  ssf = ssf || arguments.callee;
  if (ssf &amp;&amp; Error.captureStackTrace) {
    Error.captureStackTrace(this, ssf);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.errors.MessageSerializationError.prototype.serialize" id="apidoc.element.apnagent.errors.MessageSerializationError.prototype.serialize">
        function <span class="apidocSignatureSpan">apnagent.errors.MessageSerializationError.prototype.</span>serialize
        <span class="apidocSignatureSpan">(stack)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">serialize = function (stack) {
  var exclude = extend.exclude('constructor', 'serialize', 'toJSON', 'stack')
    , props = exclude({ name: this.name }, this);

  if (false !== stack &amp;&amp; this.stack) {
    props.stack = this.stack;
  }

  return props;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.apnagent.errors.MessageSerializationError.prototype.toJSON" id="apidoc.element.apnagent.errors.MessageSerializationError.prototype.toJSON">
        function <span class="apidocSignatureSpan">apnagent.errors.MessageSerializationError.prototype.</span>toJSON
        <span class="apidocSignatureSpan">(stack)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toJSON = function (stack) {
  var exclude = extend.exclude('constructor', 'serialize', 'toJSON', 'stack')
    , props = exclude({ name: this.name }, this);

  if (false !== stack &amp;&amp; this.stack) {
    props.stack = this.stack;
  }

  return props;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.apnagent.errors.MessageSerializationError.prototype.serialize" id="apidoc.module.apnagent.errors.MessageSerializationError.prototype.serialize">module apnagent.errors.MessageSerializationError.prototype.serialize</a></h1>


    <h2>
        <a href="#apidoc.element.apnagent.errors.MessageSerializationError.prototype.serialize.serialize" id="apidoc.element.apnagent.errors.MessageSerializationError.prototype.serialize.serialize">
        function <span class="apidocSignatureSpan">apnagent.errors.MessageSerializationError.prototype.</span>serialize
        <span class="apidocSignatureSpan">(stack)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">serialize = function (stack) {
  var exclude = extend.exclude('constructor', 'serialize', 'toJSON', 'stack')
    , props = exclude({ name: this.name }, this);

  if (false !== stack &amp;&amp; this.stack) {
    props.stack = this.stack;
  }

  return props;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>